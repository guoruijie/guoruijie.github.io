<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>郭璞博文</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="记录进步的点点滴滴">
<meta property="og:type" content="website">
<meta property="og:title" content="郭璞博文">
<meta property="og:url" content="http://guoruibiao.github.io/index.html">
<meta property="og:site_name" content="郭璞博文">
<meta property="og:description" content="记录进步的点点滴滴">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="郭璞博文">
<meta name="twitter:description" content="记录进步的点点滴滴">
  
    <link rel="alternate" href="/atom.xml" title="郭璞博文" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">郭璞博文</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">人生的乐趣不止编程，但没有编程，一定不快乐！</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://guoruibiao.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-QQ空间模拟登陆点赞发帖" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/13/QQ空间模拟登陆点赞发帖/" class="article-date">
  <time datetime="2016-12-13T07:49:50.000Z" itemprop="datePublished">2016-12-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/13/QQ空间模拟登陆点赞发帖/">QQ空间模拟登陆点赞发帖</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><p>很久之前就想着要写个脚本，要么去刷12306的票，要么就登QQ空间。为什么呢？你想啊，别人刚发一个说说，然后你就能检测到并秒赞回去，这得多让人惊讶。（不小心暴露了异想天开的本质啦，⊙﹏⊙b汗）。</p>
<p>一开始学习Python的时候就模拟着试了试，除非借助于cookie那块，不然也是没法成功的。然而这次歪打正着。本学期有个《软件工程导论》课程，刚好讲到了测试这块，然后就提到了自动化测试，以及在此行业中的翘楚Selenium，结果就是发现了新大陆一般，觉得拿来测试模拟登陆应该会比较不错。</p>
<p>于是，真的成功啦。在此记录一下，走过的历程，填过的坑。</p>
<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><p>Selenium是一个支持多语言的自动化测试框架，不管是Java， Ruby，还是Python，都能使用其支持的库来进行自动化测试。我本人最喜欢Python语言，所以这里将会以Python语言进行测试。</p>
<h3 id="驱动"><a href="#驱动" class="headerlink" title="驱动"></a>驱动</h3><p>Selenium是典型的CS框架，浏览器作为Server执行Client（selenium代码）的请求，通过“代理”这么个理念实现自动化测试。 这么说可能不太通俗，换句话就是selenium执行的时候会调用浏览器，根据设置好的代码运行，最终实现自动化测试。</p>
<p>selenium2之后，以webdriver代替Proxy功能，处理所有请求。</p>
<p>所以不管怎么说，浏览器都是必不可少的啦。因此我们需要安装一下浏览器驱动。</p>
<p>关于浏览器驱动的问题，可能就是阻挡了大部分人使用selenium的拦路虎吧。</p>
<h4 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h4><p>下载驱动的话，可以到 <a href="http://www.seleniumhq.org/projects/webdriver/" target="_blank" rel="external">http://www.seleniumhq.org/projects/webdriver/</a></p>
<p>这个网址进行下载。按需下载即可，待会会讲解怎么使用，我这里下载的是firefoxdriver.exe</p>
<p><img src="http://img.blog.csdn.net/20161213152713696?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvTWFya3Npbm9iZXJn/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="下载webdriver驱动"></p>
<h3 id="selenium"><a href="#selenium" class="headerlink" title="selenium"></a>selenium</h3><p>安装selenium也是很方便的。</p>
<p>如果您已安装比较旧的版本：</p>
<blockquote>
<p>pip install -U selenium</p>
</blockquote>
<p>如果您还未安装selenium：</p>
<blockquote>
<p>pip install selenium</p>
</blockquote>
<p>这样就完事了。</p>
<h2 id="驱动安装问题集"><a href="#驱动安装问题集" class="headerlink" title="驱动安装问题集"></a>驱动安装问题集</h2><p>下面聊聊我在这个过程中遇到的一些奇怪的问题，可能不具备普适性。</p>
<h3 id="未发现驱动"><a href="#未发现驱动" class="headerlink" title="未发现驱动"></a>未发现驱动</h3><p>如果驱动没有正确放置，就会报出下面的错误。<br><img src="http://img.blog.csdn.net/20161213152757868?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvTWFya3Npbm9iZXJn/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="驱动未正确配置"></p>
<p>解决办法就是将刚才下载的driver放置到Python的Path或者放到任意一个系统能找得到的Path中。我个人建议放置到Python的根目录中，这样便于管理。</p>
<h3 id="firefox驱动错误"><a href="#firefox驱动错误" class="headerlink" title="firefox驱动错误"></a>firefox驱动错误</h3><p>主要症状就是无法开启，闪退。这个时候我们需要下载一个geckodriver.exe。</p>
<p>可以在下面的链接中找到适合自己系统版本的来使用。</p>
<p><a href="https://github.com/mozilla/geckodriver/releases" target="_blank" rel="external">https://github.com/mozilla/geckodriver/releases</a></p>
<p>下载完之后放置到Python路径中即可，处理方法和刚才的那个一样。然后问题就解决了（反正我是这么解决的啦）。</p>
<h2 id="模拟登陆"><a href="#模拟登陆" class="headerlink" title="模拟登陆"></a>模拟登陆</h2><p>下面开始步入正题了，使用selenium进行模拟登陆其实就可以想象成有一双无形的手在进行用户名，密码填写，然后点击按钮等等。这样就会变得很容易理解了。</p>
<p>这里关于selenium选择器等等的基础性的知识点就不再讲解了，网上资料很多，也很详细。相信大家一看就会明白的。</p>
<p>我自己最常用也最喜欢的就是：</p>
<blockquote>
<p>driver.get_element_by_id()<br>driver.get_element_by_xpath()</p>
</blockquote>
<p>然后要登录QQ空间，就得先看看人家长什么样吧，如图：</p>
<p><img src="http://img.blog.csdn.net/20161213153011949?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvTWFya3Npbm9iZXJn/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="QQ空间首页"></p>
<h3 id="首败"><a href="#首败" class="headerlink" title="首败"></a>首败</h3><p>按下F12就可以查看网页的源代码了，所以什么用户名啊，密码啊，登陆按钮啊都不是事了。不多说，直接上代码。</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#coding: utf8</span></span><br><span class="line"></span><br><span class="line">from selenium import webdriver</span><br><span class="line"></span><br><span class="line">driver = webdriver.Firefox()</span><br><span class="line"></span><br><span class="line">driver.<span class="built_in">get</span>(<span class="string">'http://i.qq.com/'</span>)</span><br><span class="line"></span><br><span class="line">driver.find_element_by_id(<span class="string">'switcher_plogin'</span>).<span class="built_in">click</span>()</span><br><span class="line"></span><br><span class="line">driver.find_element_by_name(<span class="string">'u'</span>).<span class="built_in">clear</span>()</span><br><span class="line">driver.find_element_by_name(<span class="string">'u'</span>).send_keys(<span class="string">'你的QQ号'</span>)</span><br><span class="line">driver.find_element_by_name(<span class="string">'p'</span>).<span class="built_in">clear</span>()</span><br><span class="line">driver.find_element_by_name(<span class="string">'p'</span>).send_keys(<span class="string">'你的密码'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">driver.find_element_by_xpath(<span class="string">'//*[@id="loginform"]/div[4]/a'</span>).<span class="built_in">click</span>()</span><br><span class="line">driver.find_element_by_id(<span class="string">'login_button'</span>).<span class="built_in">click</span>()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> driver.current_url</span><br></pre></td></tr></table></figure>
<p>然而我发现我想多了，真正的考验才刚刚开始。这样根本就找不到网页源代码中看到的那些个id啊class什么的。</p>
<h3 id="再败"><a href="#再败" class="headerlink" title="再败"></a>再败</h3><p>既然找不到，可能就是代码的问题了。然后我又仔仔细细的查看了一下代码，发现也没啥错误啊。然后不甘心，又去看了看网页的源代码。结果还真的被我发现了。</p>
<p>尼玛，这叫什么事嘛。</p>
<p>如下图，不难发现了吧。<br><img src="http://img.blog.csdn.net/20161213153151151?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvTWFya3Npbm9iZXJn/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="多了个iframe"></p>
<p>有一个iframe，怪不得Selenium找不到，既然如此，那咱们就乘胜追击。修改一下代码呗。</p>
<figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">#c</span>oding: utf<span class="number">8</span></span><br><span class="line"></span><br><span class="line">from selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">driver = webdriver.Firefox()</span><br><span class="line"></span><br><span class="line">driver.get(<span class="string">'http://i.qq.com/'</span>)</span><br><span class="line">driver.<span class="keyword">switch</span><span class="number">_</span>to.frame(<span class="string">'login_frame'</span>)</span><br><span class="line">driver.find<span class="number">_</span>element<span class="number">_</span><span class="meta">by</span><span class="number">_</span>id(<span class="string">'switcher_plogin'</span>).click()</span><br><span class="line"></span><br><span class="line">driver.find<span class="number">_</span>element<span class="number">_</span><span class="meta">by</span><span class="number">_n</span>ame(<span class="string">'u'</span>).clear()</span><br><span class="line">driver.find<span class="number">_</span>element<span class="number">_</span><span class="meta">by</span><span class="number">_n</span>ame(<span class="string">'u'</span>).send<span class="number">_k</span>eys(<span class="string">'你的QQ号'</span>)</span><br><span class="line">driver.find<span class="number">_</span>element<span class="number">_</span><span class="meta">by</span><span class="number">_n</span>ame(<span class="string">'p'</span>).clear()</span><br><span class="line">driver.find<span class="number">_</span>element<span class="number">_</span><span class="meta">by</span><span class="number">_n</span>ame(<span class="string">'p'</span>).send<span class="number">_k</span>eys(<span class="string">'你的密码'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">driver.find<span class="number">_</span>element<span class="number">_</span><span class="meta">by</span><span class="number">_</span>xpath(<span class="string">'//*[@id="loginform"]/div[4]/a'</span>).click()</span><br><span class="line">driver.find<span class="number">_</span>element<span class="number">_</span><span class="meta">by</span><span class="number">_</span>id(<span class="string">'login_button'</span>).click()</span><br><span class="line"></span><br><span class="line">print driver.current<span class="number">_u</span>rl</span><br></pre></td></tr></table></figure>
<p>加上了这么一行：</p>
<blockquote>
<p>driver.switch_to.frame(‘login_frame’)</p>
</blockquote>
<p>作用就是根据iframe的id或name来跳转到这个iframe上。</p>
<p>本以为完事大吉咯，终于可以秒赞了，耶。</p>
<p>然而事实给了我一个残酷的打击。到最后一个“登录”按钮点击的时候停了下来。结果还是失败了。</p>
<h3 id="成功"><a href="#成功" class="headerlink" title="成功"></a>成功</h3><p>它越是这样，我就越想写出来。没办法，硬着头皮上呗，直觉上还是QQ空间源代码的问题，于是这次就直接继续看源代码去了。<br>果不其然，发现了下图这么个代码。<br><img src="http://img.blog.csdn.net/20161213153357642?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvTWFya3Npbm9iZXJn/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="hidefocus问题"></p>
<p>然后我就想使用JS来把这个故意隐藏不让focus的给显现出来。</p>
<p>恩，我就是这么做的，然后真的就成功了。核心就添加了下面的这行代码。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver<span class="selector-class">.execute_script</span>(<span class="string">"document.getElementById('login_button').parentNode.hidefocus=false;"</span>)</span><br></pre></td></tr></table></figure>
<p>下面贴出来完整的代码吧，方便参考。</p>
<figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">#c</span>oding: utf<span class="number">8</span></span><br><span class="line"></span><br><span class="line">from selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">driver = webdriver.Firefox()</span><br><span class="line"></span><br><span class="line">driver.get(<span class="string">'http://i.qq.com/'</span>)</span><br><span class="line">driver.<span class="keyword">switch</span><span class="number">_</span>to.frame(<span class="string">'login_frame'</span>)</span><br><span class="line">driver.find<span class="number">_</span>element<span class="number">_</span><span class="meta">by</span><span class="number">_</span>id(<span class="string">'switcher_plogin'</span>).click()</span><br><span class="line"></span><br><span class="line">driver.find<span class="number">_</span>element<span class="number">_</span><span class="meta">by</span><span class="number">_n</span>ame(<span class="string">'u'</span>).clear()</span><br><span class="line">driver.find<span class="number">_</span>element<span class="number">_</span><span class="meta">by</span><span class="number">_n</span>ame(<span class="string">'u'</span>).send<span class="number">_k</span>eys(<span class="string">'你的QQ号'</span>)</span><br><span class="line">driver.find<span class="number">_</span>element<span class="number">_</span><span class="meta">by</span><span class="number">_n</span>ame(<span class="string">'p'</span>).clear()</span><br><span class="line">driver.find<span class="number">_</span>element<span class="number">_</span><span class="meta">by</span><span class="number">_n</span>ame(<span class="string">'p'</span>).send<span class="number">_k</span>eys(<span class="string">'你的密码'</span>)</span><br><span class="line"></span><br><span class="line">driver.execute<span class="number">_</span>script(<span class="string">"document.getElementById('login_button').parentNode.hidefocus=false;"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">driver.find<span class="number">_</span>element<span class="number">_</span><span class="meta">by</span><span class="number">_</span>xpath(<span class="string">'//*[@id="loginform"]/div[4]/a'</span>).click()</span><br><span class="line">driver.find<span class="number">_</span>element<span class="number">_</span><span class="meta">by</span><span class="number">_</span>id(<span class="string">'login_button'</span>).click()</span><br><span class="line"></span><br><span class="line">print driver.current<span class="number">_u</span>rl</span><br></pre></td></tr></table></figure>
<h3 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h3><p>下面使用一个gif图来演示一下模拟登陆的效果，方便流畅性的观看，也更具说服力。</p>
<p><img src="http://img.blog.csdn.net/20161213151822802?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvTWFya3Npbm9iZXJn/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="QQ空间模拟登陆"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>到此基本上已经可以拿来使用了。无非在登陆成功的界面下使用Selenium模拟进行一些点击操作。如果想发点文字的话也是很方便的，send_keys可以很好的解决这个问题。什么秒赞，秒答都不是什么事了。</p>
<p>但是需要注意的是，QQ空间对登陆频率是做了限制的，就算是手动登陆，连续几次之后就会让我们输入验证码。这也是一种安全机制罢了。</p>
<p>如果有需要的话，Python处理验证码的模块也是非常好用的。这里就不再介绍了。</p>
<p>最后，Selenium给我的感悟就是：我自己对Selenium有点大材小用了，这样一款优秀的测试框架，却拿来做这种小玩意，确实是有点说不过去。</p>
<p>另外我也认识到了，测试的目的是为了提供更好的服务。而不是拿来当做攻击的手段。恶意的发水机，这种行为极不负责任，希望我们都能谨言慎行，共同营造一个和谐的网络家园。</p>
<p>心正了，人才会正直。感谢Selenium给我的这个启迪。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://guoruibiao.github.io/2016/12/13/QQ空间模拟登陆点赞发帖/" data-id="ciwn7l62b000zksu1qm4qpcmg" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Selenium/">Selenium</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-文件上传工具" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/29/文件上传工具/" class="article-date">
  <time datetime="2016-11-29T12:37:42.000Z" itemprop="datePublished">2016-11-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/29/文件上传工具/">文件上传工具</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<p>一直以来，Python的requests库都没能正式的接触到。今天这么一试，才发现原来是这么的强大。感情之前的urllib， urllib2都没这么的智能。于是思量着做了个小工具， 配合PHP写了一个命令行下的文件上传小工具。</p>
<hr>
<h3 id="后台搭建"><a href="#后台搭建" class="headerlink" title="后台搭建"></a>后台搭建</h3><h4 id="开心太早"><a href="#开心太早" class="headerlink" title="开心太早"></a>开心太早</h4><p>由于最后会在命令行里面使用，所以用不着什么花哨的界面（其实是写不出来，╭(╯^╰)╮）。</p>
<p>大致的对比了一下，觉得还是前后端一致的好，然后就尝试着使用Python写文件上传处理的后台逻辑。</p>
<p>东西都写好了，利用Flask优雅的路由，实现的一个不错的后台。然后</p>
<blockquote>
<p><a href="http://127.0.0.1:5000/upload" target="_blank" rel="external">http://127.0.0.1:5000/upload</a></p>
</blockquote>
<p>完美！  原来这么简单哦。</p>
<p>然而终究是高兴的太早，让我尝试着让局域网中的同学测试一下帮忙测试一下的时候，发现了这个致命的问题。</p>
<blockquote>
<p><a href="http://192.168.···" target="_blank" rel="external">http://192.168.···</a> </p>
</blockquote>
<p>网段内连接超时。 WTF，然后试了几遍还是不行，后来就看代码，一点点的排查，也没有发现什么错误。后来恍然大悟，需要部署到生产服务器上才行，OMG 忙活半天，把这件事给忘了。</p>
<p>然后也不想写了，确切的说不想用Python写了。</p>
<h4 id="另类脚本"><a href="#另类脚本" class="headerlink" title="另类脚本"></a>另类脚本</h4><p>然后对比了一下Java和PHP。果断选择了PHP，不是不会用Java，而是不想搞得那么复杂了，建工程，导包，配环境··· ···</p>
<p>用上PHP就好多了，几个函数就搞定了嘛。（因为是自己用，所以错误检查什么的都没做，实际开发中万万不可这样。）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span><br><span class="line">$storagepath = <span class="keyword">isset</span>($_REQUEST[<span class="string">'storagepath'</span>])?$_REQUEST[<span class="string">'storagepath'</span>]: <span class="string">"./upload/"</span>;</span><br><span class="line"></span><br><span class="line">$filename = $_FILES[<span class="string">'file'</span>][<span class="string">'name'</span>];</span><br><span class="line">$tempfile = $_FILES[<span class="string">'file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(file_exists($storagepath.$filename)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> $storagepath.$filename.<span class="string">" has existed!"</span>	;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(move_uploaded_file($tempfile, $storagepath.$filename))&#123;</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"$filename uploaded succeed, and you can see at $storagepath !"</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="keyword">echo</span> $_FILES[<span class="string">'file'</span>][<span class="string">'error'</span>];</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"failed!"</span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h4><p>接下来就是部署到服务器上了。先在本地测试了一下，发现正常。然后就远程登录到阿里云的学生机服务器上了。</p>
<p>当然了，我事先是配好PHP+Apache环境了的。</p>
<p>把这个<code>upload.php</code>文件放到htdoc文件夹下，然后再创建一个<code>upload</code>文件夹（用于存放上传的文件）。</p>
<p>这样就完成了。如果不放心的话，可以先用浏览器测试一下，出现failed就说明部署成功了。<br><img src="http://img.blog.csdn.net/20161129202137499" alt="建议验证部署效果"></p>
<h3 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h3><p>客户端当然还是用Python了，毕竟今天的主角是requests嘛。</p>
<h4 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#codin<span class="variable">g:</span> utf-<span class="number">8</span></span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line">import argparse</span><br><span class="line"></span><br><span class="line"># avoid numbers of http connection </span><br><span class="line">requests.adapters.DEFAULT_RETRIES = <span class="number">5</span></span><br><span class="line"># <span class="keyword">close</span> urllib3 keep-alive style</span><br><span class="line">s = requests.session()</span><br><span class="line">s.keep_alive = False</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	parser = argparse.ArgumentParser(description=<span class="string">'tool for uploading file.'</span>)</span><br><span class="line">	parser.add_argument(<span class="string">'url'</span>, <span class="built_in">type</span>=str, <span class="keyword">help</span>=<span class="string">'the server url for handling upload work.'</span>)</span><br><span class="line">	parser.add_argument(<span class="string">'-f'</span>, <span class="string">'--filepath'</span>, <span class="keyword">help</span>=<span class="string">'the full file path you want to upload'</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">args</span> = parser.parse_args()</span><br><span class="line"></span><br><span class="line">	url = <span class="keyword">args</span>.url</span><br><span class="line">	filepath = <span class="keyword">args</span>.filepath</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">files</span> = &#123;</span><br><span class="line">	    <span class="string">'file'</span>: <span class="keyword">open</span>(filepath, <span class="string">'rb'</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	# <span class="keyword">print</span> url</span><br><span class="line">	# <span class="keyword">print</span> filepath</span><br><span class="line">	result = requests.post(url, <span class="keyword">files</span>=<span class="keyword">files</span>)</span><br><span class="line">	<span class="keyword">print</span> result.text</span><br></pre></td></tr></table></figure>
<h4 id="核心"><a href="#核心" class="headerlink" title="核心"></a>核心</h4><p>可能明眼的你一下就看出来了，核心就这么一行：</p>
<blockquote>
<p>result = requests.post(url, files=files)</p>
</blockquote>
<p>指定files就好比是在表单中执行了</p>
<blockquote>
<p>enctype=”multipart/form-data”</p>
</blockquote>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><h4 id="命令清单"><a href="#命令清单" class="headerlink" title="命令清单"></a>命令清单</h4><p>关于客户端如何使用，可以使用help命令，便可输出详细的介绍文档。</p>
<blockquote>
<p>python client.py -h</p>
</blockquote>
<p>如图：<br><img src="http://img.blog.csdn.net/20161129201826988" alt="命令清单"></p>
<p>按照argparse的使用规范，在命令行中键入相对应的参数即可。</p>
<h4 id="执行"><a href="#执行" class="headerlink" title="执行"></a>执行</h4><blockquote>
<p> python client.py <a href="http://112.74.170.6/upload.php" target="_blank" rel="external">http://112.74.170.6/upload.php</a> -f Spring.png<br>如图：<br><img src="http://img.blog.csdn.net/20161129201844707" alt="执行命令"></p>
</blockquote>
<h4 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h4><p>然后，远程登录到服务器上，看看到底有没有上传成功吧。</p>
<ul>
<li>对应客户端的输入命令，上传的文件为Spring.png。</li>
</ul>
<p><img src="http://img.blog.csdn.net/20161129201951270" alt="Spring.png"></p>
<ul>
<li>双击验证图片是否损坏</li>
</ul>
<p><img src="http://img.blog.csdn.net/20161129202049911" alt="双击验证图片是否损坏"></p>
<p>如此，前后端测试通过。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>这里对于简单的文件上传做了下实现，对比实际中会用得到的，这个小工具简直不能入眼。不过还是那句话，贵在尝试。</p>
<p>requests在本次的实验中起到了至关重要的作用。但是其包含的远远不止这些，好有好多东西值得我们前去挖掘。往往精彩就在于细节。</p>
<blockquote>
<p>学而时习之，学而时思之。</p>
</blockquote>
<p>最后，如果对于那个图片上的水印有兴趣的话。可以参照博主前面的那个水印工具制作。<br><a href="http://blog.csdn.net/marksinoberg/article/details/53363533" target="_blank" rel="external">http://blog.csdn.net/marksinoberg/article/details/53363533</a></p>
<p>如果懒得弄，也可以留下您的邮箱， 与我取得联系。对于分享大业，在下乐意之至。(<em>^__^</em>) 嘻嘻……</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://guoruibiao.github.io/2016/11/29/文件上传工具/" data-id="ciwn7l65u004mksu1jioklxji" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP/">PHP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-众里寻他千百度-轻量级持久化框架" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/14/众里寻他千百度-轻量级持久化框架/" class="article-date">
  <time datetime="2016-11-14T12:15:58.000Z" itemprop="datePublished">2016-11-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/14/众里寻他千百度-轻量级持久化框架/">众里寻他千百度--轻量级持久化框架</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<p>起了一个比较文艺的标题，但是仍然感觉不能 表达出接下来这个工具的文雅。 虽然这个库是前几个月写的了，但是经过了近期小项目的考验，愈发觉得这款轻量级的库应该被更多的开发者所知晓，于是“臭不要脸”地写了这篇介绍性的文章。</p>
<hr>
<h2 id="初衷"><a href="#初衷" class="headerlink" title="初衷"></a>初衷</h2><p>对于如日中天的编程语言老大哥Java而言，其拥趸者数目定然不少。</p>
<h3 id="纯JDBC"><a href="#纯JDBC" class="headerlink" title="纯JDBC"></a>纯JDBC</h3><p>基本上而言，到达一定的阶段之后，就一定会接触到数据库了。一开始写纯正的JDBC的时候，不知道别人是怎么想的，但是对我个人而言，简直是 如坐针毡。</p>
<p>先不论使用Statement还是使用PreparedStatement来拼凑SQL语句，单单是处理ResultSet就是个不折不扣的烦心事。</p>
<h3 id="持久化框架"><a href="#持久化框架" class="headerlink" title="持久化框架"></a>持久化框架</h3><p>其实这并不是特例，大部分人都会有这么个感受。不然Hibernate等这些持久化框架也不会诞生了不是。但这也带来了一些弊端。</p>
<ul>
<li><p>首先对于新手而言，使用这些框架需要一定的学习成本，学习曲线不够平缓，这就有可能磨灭其学习的兴趣。</p>
</li>
<li><p>其次，对于小项目而言，动用重量级的框架，就显得“大材小用”了。虽然这并不是说部可以，却显得有点不合时宜。</p>
</li>
</ul>
<h3 id="轻量级持久化框架"><a href="#轻量级持久化框架" class="headerlink" title="轻量级持久化框架"></a>轻量级持久化框架</h3><p>相信大家都了解Apache的dbutils吧。大大地简化了JDBC的处理，封装了很多必须的操作。但是我个人认为它并不能称之为一个框架。 充其量是一个JDBC的Wrap版，也就是对JDBC进行了简单的封装的一个工具。</p>
<p>于是，在研究了其工作原理之后，结合Apache的另一个BeanUtils库，我制作了一个比较轻量级的数据库持久化框架。（姑且称之为框架吧，(<em>^__^</em>) 嘻嘻……）</p>
<h2 id="设计思路"><a href="#设计思路" class="headerlink" title="设计思路"></a>设计思路</h2><p>以我个人，不长的开发经验来看。“过犹不及，过满则亏”。所以对于框架的设计原则也应该如此。</p>
<blockquote>
<p>不能什么都做，要适时的将权限放开，增加拓展。</p>
</blockquote>
<p>仔细思考了，到底要拿它来做什么？ 如何添加拓展？这些问题之后，我就开始着手编码了。</p>
<p>期间运用了 蹩脚的泛型和反射操作，自动化的解剖Bean，来解决与数据库之间的持久化和反序列化处理等等。</p>
<p>大体的“架构” 可用下图表示：</p>
<p><img src="http://img.blog.csdn.net/20160719164640373" alt="架构图"></p>
<h2 id="怎么使用？"><a href="#怎么使用？" class="headerlink" title="怎么使用？"></a>怎么使用？</h2><p>介绍到如何使用，我觉得还是以实际的使用案例来介绍比较好，这样更有说服力。</p>
<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><p>因为这个框架依赖于apache的一些jar，所以我们需要将下列依赖添加到自己的项目中。（我个人建议在项目中新建一个lib包来放置jar文件）<br><img src="http://img.blog.csdn.net/20161114193133098" alt="jar依赖"></p>
<h3 id="数据库配置"><a href="#数据库配置" class="headerlink" title="数据库配置"></a>数据库配置</h3><p>因为JDBC是跨数据库的，所以我们只要提供针对不同的数据库厂商的jar，那么这个框架也可以跨数据库。</p>
<p>如上图可以看到 src目录下有一个db.cfg.xml的文件。这里面就放置了之前要手动处理的数据库配置信息了。比葫芦画瓢，按照下面的代码配置自己的环境即可。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span> <span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">database</span> <span class="attr">name</span>=<span class="string">"mysql"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">driver</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">driver</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url</span>&gt;</span>jdbc:mysql://localhost:3306/mydb<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">user</span>&gt;</span>root<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">password</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">database</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>基本上来说，大家都会有专门的BaseDAO类，那么在这个类里面进行数据库配置的注册事件是最合适不过了。</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"><span class="meta-keyword">import</span> dbhelper.DbHelper;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * @author 郭 璞</span><br><span class="line"> *</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseDAO</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 * 使用静态代码块的方式，在程序的DAO层运行之前就注册好 DbHelper ，做好对数据源的注册</span><br><span class="line">	 */</span></span><br><span class="line">	<span class="keyword">static</span> &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			DbHelper.register();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e + <span class="string">"\n 数据源未注册成功"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样，其他的DAO只需要继承这个类就可以了，我们就不用关心数据源的问题了，底层框架会自动的帮我们搞定。</p>
<h3 id="正式使用"><a href="#正式使用" class="headerlink" title="正式使用"></a>正式使用</h3><p>有一点需要强调的是，数据库中的字段要和Java Bean中的属性名保持高度的一致，否则框架不能正确的找到其隶属的字段信息。毕竟框架不是万能的嘛。</p>
<h4 id="数据库表结构"><a href="#数据库表结构" class="headerlink" title="数据库表结构"></a>数据库表结构</h4><p><img src="http://img.blog.csdn.net/20161114194025423" alt="数据库表字段"></p>
<h4 id="Java-Bean结构"><a href="#Java-Bean结构" class="headerlink" title="Java Bean结构"></a>Java Bean结构</h4><p><img src="http://img.blog.csdn.net/20161114194131716" alt="JavaBean字段"></p>
<p>如图所示， 按照这样来设计就可以了。</p>
<h4 id="从数据库获取一条记录，并转为对象"><a href="#从数据库获取一条记录，并转为对象" class="headerlink" title="从数据库获取一条记录，并转为对象"></a>从数据库获取一条记录，并转为对象</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 根据用户名查找其个人的详细的信息</span><br><span class="line"> * </span><br><span class="line"> * <span class="doctag">@param</span> user_name</span><br><span class="line"> * <span class="doctag">@return</span></span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> User selectUser(String user_name) &#123;</span><br><span class="line">	<span class="comment">// 声明数据库连接对象</span></span><br><span class="line">	Connection conn = <span class="literal">null</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">// 初始化 数据库连接对象，避免出现空指针调用异常问题</span></span><br><span class="line">		conn = DbHelper.getConn();</span><br><span class="line">		<span class="comment">// 组装 SQL 查询语句</span></span><br><span class="line">		String sql = <span class="string">"select * from java_user where user_name= ?"</span>;</span><br><span class="line">		<span class="comment">// 实例化数据库查询对象</span></span><br><span class="line">		QueryRunner queryRunner = <span class="keyword">new</span> QueryRunner();</span><br><span class="line">		<span class="comment">// 采用 泛型编程技术 ，从底层开始直接获取数据库行记录到对象的自动转化流程</span></span><br><span class="line">		User user = queryRunner.query(conn, sql, <span class="keyword">new</span> BeanHandler&lt;User&gt;(User.<span class="keyword">class</span>), user_name);</span><br><span class="line">		<span class="comment">// 释放数据库链接资源</span></span><br><span class="line">		DbHelper.release(conn);</span><br><span class="line">		<span class="keyword">return</span> user != <span class="literal">null</span> ? user : <span class="literal">null</span>;</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">" :\n"</span> + e);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>与此同时，数据库中的记录如下图：<br><img src="http://img.blog.csdn.net/20161114194653649" alt="数据库中记录信息"></p>
<p>下面使用JUnit来测试一下，<br><img src="http://img.blog.csdn.net/20161114194732314" alt="Junit测试结果"></p>
<p>可见，确实可以自动的帮助我们反序列化数据库中的数据。</p>
<hr>
<h3 id="高级版"><a href="#高级版" class="headerlink" title="高级版"></a>高级版</h3><p>上面的小案例简单的测试了一下，单个Bean对象的获取，那么如果说ResultSet内包含多条记录呢？ 这时候你可能会想，要是能自动的转换成List，然后List里面包裹着这些反序列化好的数据对象，该多好。</p>
<p>确实是这样的，DbHelper也做到了。(<em>^__^</em>) 嘻嘻……</p>
<h4 id="数据库内记录"><a href="#数据库内记录" class="headerlink" title="数据库内记录"></a>数据库内记录</h4><p>闲言少叙，咱们直接开始吧。</p>
<p><img src="http://img.blog.csdn.net/20161114195127565" alt="数据库内字段信息"></p>
<h4 id="JavaBean结构"><a href="#JavaBean结构" class="headerlink" title="JavaBean结构"></a>JavaBean结构</h4><p>按照约定，java Bean 内字段保持和数据库内表结构字段一致即可。</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> class Site &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="built_in">String</span> site_name;</span><br><span class="line">	<span class="keyword">private</span> <span class="built_in">String</span> site_username;</span><br><span class="line">	<span class="keyword">private</span> <span class="built_in">String</span> site_password;</span><br><span class="line">	<span class="keyword">private</span> <span class="built_in">Integer</span> java_user_id;</span><br><span class="line">	<span class="keyword">private</span> <span class="built_in">Integer</span> java_tag_tag_id;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">String</span> getsite_name() &#123;</span><br><span class="line">		<span class="keyword">return</span> site_name;</span><br><span class="line">	&#125;</span><br><span class="line">	··· ···</span><br></pre></td></tr></table></figure>
<p>然后就是 DAO层内的业务代码了，还是那简单的几步。需要注意的是，接口回调的时候new的不再是BeanHandler了，而是BeanListHandler。这和返回的结果集直接相关。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public <span class="built_in">List</span>&lt;Site&gt; selectAllSites(<span class="built_in">String</span> user_name) &#123;</span><br><span class="line">		Connection conn = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">		    <span class="comment">// 实例化 数据库连接对象</span></span><br><span class="line">			conn = DbHelper.getConn();</span><br><span class="line">			<span class="comment">// 拼接sql语句</span></span><br><span class="line">			<span class="built_in">String</span> sql = <span class="string">"select * from java_site where java_site.java_user_id=(select java_user.id from java_user where java_user.user_name='"</span></span><br><span class="line">					+ user_name + <span class="string">"')"</span>;</span><br><span class="line">			<span class="comment">// 实例化查询器</span></span><br><span class="line">			QueryRunner queryRunner = <span class="keyword">new</span> QueryRunner();</span><br><span class="line">			<span class="comment">// 获取接口回调处理后的结果</span></span><br><span class="line">			<span class="built_in">List</span>&lt;Site&gt; sites = queryRunner.query(conn, sql, <span class="keyword">new</span> BeanListHandler&lt;Site&gt;(Site.<span class="keyword">class</span>));</span><br><span class="line">			<span class="comment">// 释放数据库链接资源</span></span><br><span class="line">			DbHelper.release(conn);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> sites != <span class="keyword">null</span> ? sites : <span class="keyword">null</span>;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">" :\n"</span> + e);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>然后再来看看JUnit的测试结果：<br><img src="http://img.blog.csdn.net/20161114195732583" alt="JUnit List 测试结果"></p>
<p>果不其然，还是获取到了正确的数据。这一点可以和数据库中原始的信息进行对比。</p>
<h3 id="拓展"><a href="#拓展" class="headerlink" title="拓展"></a>拓展</h3><p>为了使得这个框架更加的灵活， 满足大部分的定制性的需求，这里给QueryRunner 额外进行了拓展。可以灵活的处理自己的业务需求。</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">	 * 根据给定的参数实现向数据库中给定SQL语句的update,delete,insert 操作</span><br><span class="line">	 * </span><br><span class="line">	 * <span class="doctag">@param</span> conn</span><br><span class="line">	 *            数据库连接对象，用户不必关心其释放问题，这里自动将其释放</span><br><span class="line">	 * <span class="doctag">@param</span> sql</span><br><span class="line">	 *            数据库查询语句</span><br><span class="line">	 * <span class="doctag">@param</span> params</span><br><span class="line">	 *            对应于SQL语句占位符的参数列表</span><br><span class="line">	 * <span class="doctag">@throws</span> Exception</span><br><span class="line">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(Connection conn, String sql, Object... params)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		PreparedStatement ps = conn.prepareStatement(sql);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; params.length; i++) &#123;</span><br><span class="line">			ps.setObject((i + <span class="number">1</span>), params[i]);</span><br><span class="line">		&#125;</span><br><span class="line">		ps.executeUpdate();</span><br><span class="line">		DbHelper.release(conn, ps);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>使用的时候只需要将组装好的sql语句传给query方法即可。如：</p>
<figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">	 * 更新 网站对应的标签信息</span><br><span class="line">	 * </span><br><span class="line">	 * <span class="doctag">@param</span> site_name</span><br><span class="line">	 *            网站名称</span><br><span class="line">	 * <span class="doctag">@param</span> new_java_tag_tag_id</span><br><span class="line">	 *            新的标签信息</span><br><span class="line">	 * <span class="doctag">@return</span></span><br><span class="line">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">boolean</span> updateSiteTagID(String site_name, Integer new_java_tag_tag_id) &#123;</span><br><span class="line">		Connection conn = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			conn = DbHelper.getConn();</span><br><span class="line">			String sql = <span class="string">"update java_site set java_tag_tag_id=? where site_name=?"</span>;</span><br><span class="line">			QueryRunner queryRunner = <span class="keyword">new</span> QueryRunner();</span><br><span class="line">			Object[] params = &#123; new_java_tag_tag_id, site_name &#125;;</span><br><span class="line">			<span class="comment">// 在完成更新操作后，底层会自动的断开与数据库的链接</span></span><br><span class="line">			queryRunner.update(conn, sql, params);</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (<span class="keyword">Exception</span> e) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">" :\n"</span> + e);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>如此，基本上可以满足JDBC编程时遇到的情况了。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>其实博主本人真的是一个爱分享，热心肠的有志青年。今天写这篇文章的一个很重要的原因就是想帮助那些饱受JDBC之苦的开发人员，今早的以一种优雅的方式脱离苦海。</p>
<p>这篇文章从应用性的角度而言，应该算是比较详细的了。但是基本上没有讨论底层的实现。</p>
<p>如果您对这个轻量级的框架感兴趣的话，不妨点点左侧的友情链接。</p>
<p><img src="http://img.blog.csdn.net/20161114200646714" alt="友情链接"></p>
<ul>
<li>想要源码： 点击蓝色的“GitHub”</li>
<li>一起讨论： 点击红色的“点我聊天”（我有可能会不在线）</li>
<li>联系方式：  发私信或者从GitHub上找到我的邮箱。</li>
</ul>
<p>最后，衷心希望需要的人 能从中获得帮助。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://guoruibiao.github.io/2016/11/14/众里寻他千百度-轻量级持久化框架/" data-id="ciwn7l67i005fksu183gbkqf2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DbHelper/">DbHelper</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Chatter-in-console" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/10/31/Chatter-in-console/" class="article-date">
  <time datetime="2016-10-31T08:35:20.000Z" itemprop="datePublished">2016-10-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/31/Chatter-in-console/">Chatter in console</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<p>今天比较闲，简单的做了一个命令行下的聊天机器人，接口还是之前做android聊天机器人的时候申请的key，没想到现在还没有失效。╭(╯^╰)╮</p>
<hr>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><h3 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h3><p>原理就是使用图灵机器人接口。网址如下：<a href="http://www.tuling123.com/" target="_blank" rel="external">http://www.tuling123.com/</a></p>
<p>官网简易使用post的方式进行网络请求，所以最好也是按照官网的来。</p>
<p>发送的格式是一致的，但是返回的数据类型却不是一致的。这一点可以通过返回的JSON串中的code属性进行区分。</p>
<p><img src="http://img.blog.csdn.net/20161031160852508" alt="返回数据"></p>
<p>详细的信息，可以参照API中的讲解，异常的详细，(<em>^__^</em>) 嘻嘻……<br><a href="http://www.tuling123.com/help/h_cent_webapi.jhtml?nav=doc" target="_blank" rel="external">http://www.tuling123.com/help/h_cent_webapi.jhtml?nav=doc</a></p>
<h3 id="语音"><a href="#语音" class="headerlink" title="语音"></a>语音</h3><p>这里和之前Android上写的不同，那就是添加了语音模块，也就是说，电脑会通过扬声器来和您对话。</p>
<p>依赖： pyttsx</p>
<p>详细的使用可以参考一下博主之前写过的这篇文章：<br><a href="http://blog.csdn.net/Marksinoberg/article/details/52137547?locationNum=1&amp;fps=1" target="_blank" rel="external">http://blog.csdn.net/Marksinoberg/article/details/52137547?locationNum=1&amp;fps=1</a></p>
<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"># coding:utf<span class="number">-8</span></span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">'utf8'</span>)</span><br><span class="line">#    __author__ = <span class="string">'郭 璞'</span></span><br><span class="line">#    __date__ = <span class="string">'2016/10/31'</span></span><br><span class="line">#    __Desc__ = 图灵机器人测试</span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line">import urllib, urllib2</span><br><span class="line">import json</span><br><span class="line">import jieba</span><br><span class="line">import pyttsx</span><br><span class="line">from random import randint</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 一次性初始化语音引擎，减少资源的打开关闭开销</span><br><span class="line">engine = pyttsx.init()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 对语句进行分词，分词列表中将包含查询所需的关键字,这里暂且用不到了（接口已经完成了此项任务）</span><br><span class="line">def parseText(text):</span><br><span class="line">    words = []</span><br><span class="line">    words = jieba.cut(text, cut_all=True)</span><br><span class="line">    return list(<span class="keyword">set</span>(words))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 根据post方式获取到返回信息</span><br><span class="line">def <span class="comment">getResult(url, payload):</span></span><br><span class="line">    res <span class="comment">= requests.post(url=url, data=payload)</span></span><br><span class="line">    return <span class="comment">res</span></span><br><span class="line"></span><br><span class="line">def <span class="comment">getData(url, payload):</span></span><br><span class="line">    payload <span class="comment">= urllib.urlencode(payload)</span></span><br><span class="line">    req <span class="comment">= urllib2.Request(url=url, data=payload)</span></span><br><span class="line">    return <span class="comment">urllib2.urlopen(req).read()</span></span><br><span class="line"></span><br><span class="line"># 初始化语音引擎，让电脑读出来</span><br><span class="line">def <span class="comment">say(text):</span></span><br><span class="line">    rate <span class="comment">= engine.getProperty(</span><span class="comment">'rate'</span><span class="comment">)</span></span><br><span class="line">    # 控制一下语速</span><br><span class="line">    engine.setProperty(<span class="string">'rate'</span>, rate <span class="comment">- 64 + randint(10, 36))</span></span><br><span class="line">    engine.say(text)</span><br><span class="line">    engine.runAndWait()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 根据返回的code来判断属于哪一类的json数据串，方便接下来的拆解，共有</span><br><span class="line"># 10 0000 文本类</span><br><span class="line"># 20 0000 链接类</span><br><span class="line"># 30 2000 新闻类</span><br><span class="line"># 30 8000 菜谱类</span><br><span class="line"># 31 3000 儿歌类（仅针对于儿童版）</span><br><span class="line"># 31 4000 诗词类（仅针对于儿童版）</span><br><span class="line">def <span class="comment">switch(result):</span></span><br><span class="line">    code <span class="comment">= result[</span><span class="comment">'code'</span><span class="comment">]</span></span><br><span class="line"></span><br><span class="line">    if <span class="comment">code == 100000:</span></span><br><span class="line">        text <span class="comment">= result[</span><span class="comment">'text'</span><span class="comment">]</span></span><br><span class="line">        print <span class="comment">text</span></span><br><span class="line">        say(text)</span><br><span class="line"></span><br><span class="line">    elif <span class="comment">code == 200000:</span></span><br><span class="line">        text <span class="comment">= result[</span><span class="comment">'text'</span><span class="comment">]</span></span><br><span class="line">        url <span class="comment">= result[</span><span class="comment">'url'</span><span class="comment">]</span></span><br><span class="line">        print <span class="comment">text, url</span></span><br><span class="line">        say(text <span class="comment">+</span> <span class="comment">'.    不妨，点击后面的链接查看详情吧'</span><span class="comment">)</span></span><br><span class="line"></span><br><span class="line">    elif <span class="comment">code == 302000:</span></span><br><span class="line">        text <span class="comment">= result[</span><span class="comment">'text'</span><span class="comment">]</span></span><br><span class="line"></span><br><span class="line">        newslist <span class="comment">= result[</span><span class="comment">'list'</span><span class="comment">]</span></span><br><span class="line">        # 循环读取每一个条目的新闻内容</span><br><span class="line">        for <span class="comment">item in range(len(newslist)):</span></span><br><span class="line">            article <span class="comment">= newslist[item][</span><span class="comment">'article'</span><span class="comment">]</span></span><br><span class="line">            source <span class="comment">= newslist[item][</span><span class="comment">'source'</span><span class="comment">]</span></span><br><span class="line">            detailurl <span class="comment">= newslist[item][</span><span class="comment">'detailurl'</span><span class="comment">]</span></span><br><span class="line"></span><br><span class="line">            print <span class="comment">article, source, detailurl</span></span><br><span class="line"></span><br><span class="line">    elif <span class="comment">code == 308000:</span></span><br><span class="line">        text <span class="comment">= result[</span><span class="comment">'text'</span><span class="comment">]</span></span><br><span class="line">        menu <span class="comment">= result[</span><span class="comment">'list'</span><span class="comment">]</span></span><br><span class="line"></span><br><span class="line">        # 循环的打出每一条菜谱的详细信息</span><br><span class="line">        for <span class="comment">item in menu:</span></span><br><span class="line">            name <span class="comment">= item[</span><span class="comment">'name'</span><span class="comment">]</span></span><br><span class="line">            icon <span class="comment">= item[</span><span class="comment">'icon'</span><span class="comment">]</span></span><br><span class="line">            info <span class="comment">= item[</span><span class="comment">'info'</span><span class="comment">]</span></span><br><span class="line">            detailurl <span class="comment">= item[</span><span class="comment">'detailurl'</span><span class="comment">]</span></span><br><span class="line"></span><br><span class="line">            print <span class="comment">name, icon, info, detailurl</span></span><br><span class="line"></span><br><span class="line">    else:</span><br><span class="line">        print <span class="comment">'我竟无言以对，╭(╯^╰)╮'</span></span><br><span class="line">        say(<span class="string">'我表示不知道说什么好了'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 根据关键字的不同，组装出不同的post数据，以便于获取不同的结果集</span><br><span class="line">def <span class="comment">main(url=</span><span class="comment">'http://www.tuling123.com/openapi/api'</span><span class="comment">, text=</span><span class="comment">'你好'</span><span class="comment">):</span></span><br><span class="line">    payload <span class="comment">= &#123;</span></span><br><span class="line">        <span class="string">'key'</span>: <span class="string">'您申请的APPkey'</span>,</span><br><span class="line">        <span class="string">'info'</span>: text,</span><br><span class="line">        # userid 官网上说是针对每一个用户实现的不同的编号即可，这里随意指定不重复即可</span><br><span class="line">        <span class="string">'userid'</span>: <span class="string">'1357924680'</span></span><br><span class="line">    &#125;</span><br><span class="line">    # 将返回的数据以json的方式打开，并读取Reponse的内容部分</span><br><span class="line">    # result <span class="comment">= json.loads(getResult(url, payload).text)</span></span><br><span class="line">    result <span class="comment">= json.loads(getData(url, payload))</span></span><br><span class="line">    # 根据code的不同，跳转到不同的分支，实现条件语句</span><br><span class="line">    switch(result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if <span class="comment">__name__ ==</span> <span class="comment">'__main__'</span><span class="comment">:</span></span><br><span class="line">    print <span class="comment">'嗨，我是专门为你打造的一个聊天机器人，随便和我聊些什么吧，我可以陪您聊天，给您讲笑话，查新闻，查航班，查车票，还能为您找菜谱呢(*^__^*) 嘻嘻……\n\n\n'</span><span class="comment">.encode(</span><span class="comment">'gbk'</span><span class="comment">)</span></span><br><span class="line">    username <span class="comment">= raw_input(</span><span class="comment">'输入姓名后即可开始聊天，按Ctrl+C退出: '</span><span class="comment">.encode(</span><span class="comment">'gbk'</span><span class="comment">))</span></span><br><span class="line">    question <span class="comment">= raw_input(</span><span class="comment">'%s: '</span><span class="comment">.encode(</span><span class="comment">'gbk'</span><span class="comment">) % username)</span></span><br><span class="line">    while <span class="comment">True:</span></span><br><span class="line">        question <span class="comment">= question.decode(</span><span class="comment">'gbk'</span><span class="comment">)</span></span><br><span class="line">        main(text=question)</span><br><span class="line">        print <span class="comment">'---------------------------------------------------'</span></span><br><span class="line">        question <span class="comment">= raw_input(</span><span class="comment">'%s: '</span><span class="comment">.encode(</span><span class="comment">'gbk'</span><span class="comment">) % username)</span></span><br><span class="line">    print <span class="comment">'( ^_^ )/~~拜拜'</span><span class="comment">.encode(</span><span class="comment">'utf-8'</span><span class="comment">)</span></span><br></pre></td></tr></table></figure>
<p>如上所示，你可能会对<code>import</code>部分感到好奇，明显requests，jieba模块都没有用到，为什么还要引入呢？</p>
<p>答案就是一开始博主想利用<code>pyinstaller</code>将其打包成一个exe文件的，奈何种种原因没能成功。<br>一开始以为是<code>requests</code>这种第三方模块的问题，就用<code>urllib</code>,<code>urllib2</code>重写了一下，发现还是失败了。</p>
<p>究其根本是pyinstaller工具未能成功的将pyttsx打包， 因此而失败。</p>
<p>为了给自己一个警醒（纪念），就没有删掉这些没用的代码。</p>
<h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><p>由于图片不能显示声音，所以演示的效果不太好。</p>
<p><img src="http://img.blog.csdn.net/20161031162153743" alt="演示图片一"></p>
<p><img src="http://img.blog.csdn.net/20161031162220510" alt="演示图片二"></p>
<p><img src="http://img.blog.csdn.net/20161031162537826" alt="演示图片三"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>总的来说，这次没有什么难点，还是对基础模块的使用，图灵机器人这个平台确实是一个比较好的锻炼平台。比较适合用来练手和巩固基础的知识技能。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://guoruibiao.github.io/2016/10/31/Chatter-in-console/" data-id="ciwn7l6030004ksu1ac5wayxf" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JSON/">JSON</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/聊天机器人/">聊天机器人</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ECharts-In-Project" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/10/20/ECharts-In-Project/" class="article-date">
  <time datetime="2016-10-20T10:28:51.000Z" itemprop="datePublished">2016-10-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/20/ECharts-In-Project/">ECharts In Project</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<p>最近要将后台数据库上的一些数据以可视化的方法显示到前端，找来找去，发现百度开发的这套图表工具库还不错，网上搜索了一下相关的教程，也算是实现了较为简单的demo。于是写下来，记录一下。</p>
<hr>
<h2 id="ECharts"><a href="#ECharts" class="headerlink" title="ECharts"></a>ECharts</h2><p>ECharts是国人开发的一套前端的图表工具库，使用起来超方便，也很简单（当然了，前提是理解了其工作原理之后）。</p>
<p>下面简单的介绍一下，如何在项目中使用ECharts。</p>
<h3 id="下载js代码"><a href="#下载js代码" class="headerlink" title="下载js代码"></a>下载js代码</h3><p>下载地址：  <a href="http://echarts.baidu.com/" target="_blank" rel="external">http://echarts.baidu.com/</a></p>
<p>个人觉得，开发人员下载完整版会比较好一点。而且官方建议的也是下载完整版。</p>
<p><img src="http://img.blog.csdn.net/20161020170623831" alt="下载Echarts"></p>
<p>博主这里下载的是完整版，大约不到2M。</p>
<h3 id="工作原理浅析"><a href="#工作原理浅析" class="headerlink" title="工作原理浅析"></a>工作原理浅析</h3><p>其实仔细的想想，ECharts的工作就是在网页上显示了一张特殊的图片嘛。所以我们需要意识到，需要给“图片”一个一个空间，这样才会有图表的安家之所嘛。</p>
<p>然后空间有了，也就是有地皮了。要盖一个房子的话，必须得有框架不是。这样的往上面添加些砖瓦水泥什么的才能将房子盖起来。同样的，ECharts也是这么个原理。但是这个“骨架”叫Option。至于这个option需要怎么设置，官网上有详细的介绍，博主就不再这里重复的造轮子了。大家有兴趣的可以到下图展示的地方去学习。</p>
<p><img src="http://img.blog.csdn.net/20161020165645063" alt="ECharts3下载"></p>
<h3 id="在项目中引入ECharts"><a href="#在项目中引入ECharts" class="headerlink" title="在项目中引入ECharts"></a>在项目中引入ECharts</h3><p>如题，本小节就是大致的讲一下如何简单的使用这个图标库。<br>不妨看一下下面的代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>入门<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../static/js/echarts.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../static/js/sleeplib.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span>&gt;</span>开始测试<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 先准备一个用于盛放图表的容器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">'container'</span> <span class="attr">style</span>=<span class="string">"width: 600px; height: 400px;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span><br><span class="line">		<span class="comment">//通过 echarts.init 方法初始化一个 echarts 实例并通过 setOption 方法生成一个简单的柱状图</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">//基于准备好的DOM，实例化echarts实例</span></span><br><span class="line">		<span class="keyword">var</span> myChart = echarts.init(<span class="built_in">document</span>.getElementById(<span class="string">"container"</span>));</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 指定图表的配置项和数据</span></span><br><span class="line">		<span class="keyword">var</span> option1 = &#123;</span><br><span class="line">			title : &#123;</span><br><span class="line">				text : <span class="string">'ECharts 入门案例'</span></span><br><span class="line">			&#125;,</span><br><span class="line">			tooltip : &#123;</span><br><span class="line">				text : <span class="string">'鼠标放上去之后的悬浮提示语句！'</span></span><br><span class="line">			&#125;,</span><br><span class="line">			legend : &#123;</span><br><span class="line">				data : [ <span class="string">'销量'</span> ]</span><br><span class="line">			&#125;,</span><br><span class="line">			xAxis : &#123;</span><br><span class="line">				data : [ <span class="string">'衬衫'</span>, <span class="string">'羊毛衫'</span>, <span class="string">'雪纺衫'</span>, <span class="string">'裤子'</span>, <span class="string">'高跟鞋'</span>, <span class="string">'袜子'</span>, <span class="string">'内裤'</span> ]</span><br><span class="line">			&#125;,</span><br><span class="line">			yAxis : &#123;&#125;,</span><br><span class="line">			series : [ &#123;</span><br><span class="line">				name : <span class="string">'销量'</span>,</span><br><span class="line">				type : <span class="string">'bar'</span>,</span><br><span class="line">				data : [ <span class="number">7</span>, <span class="number">20</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">20</span>, <span class="number">28</span> ]</span><br><span class="line">			&#125; ]</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 使用上面的配置项作为参数，传给echart来显示</span></span><br><span class="line">		myChart.setOption(option1);</span><br><span class="line">	</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>关键在于最后一句：</p>
<blockquote>
<p>myChart.setOption(option1);</p>
</blockquote>
<p>起作用不言而喻了吧。那么，得到的效果是什么呢？ 如下图：<br><img src="http://img.blog.csdn.net/20161020170941474" alt="Tutorial测试"></p>
<p>另外手动的点击上面的那个legend为“销量”的小红色的矩形，会有惊喜的哟。</p>
<hr>
<marquee><font color="green" size="6">接下来开始进入今天的正题</font></marquee>

<hr>
<h2 id="后台处理"><a href="#后台处理" class="headerlink" title="后台处理"></a>后台处理</h2><p>后台处理包括使用PHP查询数据库，然后以数组的形式返回，再由JQuery以Ajax的形式获取数据，交给前端进行显示的过程。</p>
<h3 id="数据库端MySQL"><a href="#数据库端MySQL" class="headerlink" title="数据库端MySQL"></a>数据库端MySQL</h3><p>数据是核心，所以建库很重要。这里仅仅是为了演示，所以数据库建的很简单，如下图：<br><img src="http://img.blog.csdn.net/20161020175809823" alt="建立数据库"></p>
<h3 id="PHP端"><a href="#PHP端" class="headerlink" title="PHP端"></a>PHP端</h3><p>需要注意的是，数据库端返回的时候必须是JSON类型，这样才可以被ajax处理的更方便。</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">header(<span class="string">"Content-type=text/json;charset=UTF-8"</span>);</span><br><span class="line"></span><br><span class="line">$conn = mysql_connect(<span class="string">"localhost"</span>, <span class="string">"root"</span>, <span class="string">"mysql"</span>) <span class="keyword">or</span> die(<span class="string">"连接数据库的过程失败！"</span>);</span><br><span class="line">mysql_query(<span class="string">"set names utf-8"</span>);</span><br><span class="line">mysql_select_db(<span class="string">"test"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$resultset = mysql_query(<span class="string">"select name, age  from echartsuser"</span>, $conn);</span><br><span class="line"><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span>准备数据进行装填</span><br><span class="line">$data = array();</span><br><span class="line"><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span>实体类</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>&#123;</span></span><br><span class="line">	public $username;</span><br><span class="line">	public $age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span>处理</span><br><span class="line"><span class="keyword">while</span>($row = mysql_fetch_array($resultset, MYSQL_ASSOC)) &#123;</span><br><span class="line">	$user = <span class="keyword">new</span> User();</span><br><span class="line">	$user-&gt;username = $row[<span class="string">'name'</span>];</span><br><span class="line">	$user-&gt;age = $row[<span class="string">'age'</span>];</span><br><span class="line">	$data[] = $user;</span><br><span class="line">&#125;</span><br><span class="line">$conn.close();</span><br><span class="line"><span class="regexp">// 返回JSON类型的数据</span><br><span class="line">echo json_encode($data);</span></span><br></pre></td></tr></table></figure>
<p>那么验证返回的数据类型到底是不是JSON，我们只需要做下接口测试即可。博主使用的是Chrome浏览器，装了一个JSON的插件，所以可以很方便的检测。如下图：<br><img src="http://img.blog.csdn.net/20161020180418565" alt="JSON接口测试"></p>
<h3 id="JQuery-amp-Ajax处理"><a href="#JQuery-amp-Ajax处理" class="headerlink" title="JQuery &amp; Ajax处理"></a>JQuery &amp; Ajax处理</h3><p>JQuery真的是难的的一个函数工具库，因此使用JQuery处理起来ajax请求会降低代码编写的复杂度，其底层将自动的处理兼容性问题。这很GEEK。</p>
<p>本例，目的很明确，获取刚才的数据接口内的数据。所以代码很简单，如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 初始化两个数组，盛装从数据库中获取到的数据</span></span><br><span class="line">	<span class="keyword">var</span> names = [], ages = [];</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//调用ajax来实现异步的加载数据</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">getusers</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		$.ajax(&#123;</span><br><span class="line">			type: <span class="string">"post"</span>,</span><br><span class="line">			<span class="keyword">async</span>: <span class="literal">false</span>,</span><br><span class="line">			url: <span class="string">"../app/getuser.php"</span>,</span><br><span class="line">			data: &#123;&#125;,</span><br><span class="line">			dataType: <span class="string">"json"</span>,</span><br><span class="line">			success: <span class="function"><span class="keyword">function</span>(<span class="params">result</span>)</span>&#123;</span><br><span class="line">				<span class="keyword">if</span>(result)&#123;</span><br><span class="line">					<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; result.length; i++)&#123;</span><br><span class="line">						names.push(result[i].name);</span><br><span class="line">						ages.push(result[i].age);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			error: <span class="function"><span class="keyword">function</span>(<span class="params">errmsg</span>) </span>&#123;</span><br><span class="line">				alert(<span class="string">"Ajax获取服务器数据出错了！"</span>+ errmsg);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">	<span class="keyword">return</span> names, ages;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 执行异步请求</span></span><br><span class="line">	getusers();</span><br></pre></td></tr></table></figure>
<h3 id="ECharts-端处理"><a href="#ECharts-端处理" class="headerlink" title="ECharts 端处理"></a>ECharts 端处理</h3><p>现在“万事俱备，只欠东风”了，数据都已经有了，剩下的就是如何显示它们了。按照一开始博主的盖房子理论，下面就把骨架搭起来吧。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 初始化 图表对象</span></span><br><span class="line">		var mychart = echarts.init(document.getElementById(<span class="string">"container"</span>));</span><br><span class="line">		<span class="comment">// 进行相关项的设置，也就是所谓的搭搭骨架，方便待会的ajax异步的数据填充</span></span><br><span class="line">		var option = &#123;</span><br><span class="line">			<span class="string">title :</span> &#123;</span><br><span class="line">				<span class="string">text :</span> <span class="string">'姓名年龄分布图'</span></span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">tooltip :</span> &#123;</span><br><span class="line">				<span class="string">show :</span> <span class="literal">true</span></span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">legend :</span> &#123;</span><br><span class="line">				<span class="string">data :</span> [ <span class="string">'age'</span> ]</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">xAxis :</span> [ &#123;</span><br><span class="line">				<span class="string">data :</span> names</span><br><span class="line">			&#125; ],</span><br><span class="line">			<span class="string">yAxis :</span> [ &#123;</span><br><span class="line">				<span class="string">type :</span> <span class="string">'value'</span></span><br><span class="line">			&#125; ],</span><br><span class="line">			<span class="string">series :</span> [ &#123;</span><br><span class="line">				<span class="string">"name"</span> : <span class="string">"age"</span>,</span><br><span class="line">				<span class="string">"type"</span> : <span class="string">"bar"</span>,</span><br><span class="line">				<span class="string">"data"</span> : ages</span><br><span class="line">			&#125; ]</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 将配置项赋给chart对象，来显示相关的数据</span></span><br><span class="line">		mychart.setOption(option);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意xAxis: 里面的names,和series里面的ages就是之前JQuery使用ajax方式获取到的数据啦。</p>
</blockquote>
<h3 id="前端全部代码"><a href="#前端全部代码" class="headerlink" title="前端全部代码"></a>前端全部代码</h3><p>个人觉得有个完整的代码会给人不少的启发，那么这里还是贴出前端交互的代码吧，也方便大家查看。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>JQuery Ajax Test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../static/js/echarts.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../static/js/jquery-1.11.1.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span>&gt;</span>PHP Ajax ECahrts 测试<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span> <span class="attr">style</span>=<span class="string">"width: 600px; height: 400px;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 初始化两个数组，盛装从数据库中获取到的数据</span></span><br><span class="line">	<span class="keyword">var</span> names = [], ages = [];</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//调用ajax来实现异步的加载数据</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">getusers</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		$.ajax(&#123;</span><br><span class="line">			type: <span class="string">"post"</span>,</span><br><span class="line">			<span class="keyword">async</span>: <span class="literal">false</span>,</span><br><span class="line">			url: <span class="string">"../app/getuser.php"</span>,</span><br><span class="line">			data: &#123;&#125;,</span><br><span class="line">			dataType: <span class="string">"json"</span>,</span><br><span class="line">			success: <span class="function"><span class="keyword">function</span>(<span class="params">result</span>)</span>&#123;</span><br><span class="line">				<span class="keyword">if</span>(result)&#123;</span><br><span class="line">					<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; result.length; i++)&#123;</span><br><span class="line">						names.push(result[i].name);</span><br><span class="line">						ages.push(result[i].age);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			error: <span class="function"><span class="keyword">function</span>(<span class="params">errmsg</span>) </span>&#123;</span><br><span class="line">				alert(<span class="string">"Ajax获取服务器数据出错了！"</span>+ errmsg);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">	<span class="keyword">return</span> names, ages;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 执行异步请求</span></span><br><span class="line">	getusers();</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 初始化 图表对象</span></span><br><span class="line">		<span class="keyword">var</span> mychart = echarts.init(<span class="built_in">document</span>.getElementById(<span class="string">"container"</span>));</span><br><span class="line">		<span class="comment">// 进行相关项的设置，也就是所谓的搭搭骨架，方便待会的ajax异步的数据填充</span></span><br><span class="line">		<span class="keyword">var</span> option = &#123;</span><br><span class="line">			title : &#123;</span><br><span class="line">				text : <span class="string">'姓名年龄分布图'</span></span><br><span class="line">			&#125;,</span><br><span class="line">			tooltip : &#123;</span><br><span class="line">				show : <span class="literal">true</span></span><br><span class="line">			&#125;,</span><br><span class="line">			legend : &#123;</span><br><span class="line">				data : [ <span class="string">'age'</span> ]</span><br><span class="line">			&#125;,</span><br><span class="line">			xAxis : [ &#123;</span><br><span class="line">				data : names</span><br><span class="line">			&#125; ],</span><br><span class="line">			yAxis : [ &#123;</span><br><span class="line">				type : <span class="string">'value'</span></span><br><span class="line">			&#125; ],</span><br><span class="line">			series : [ &#123;</span><br><span class="line">				<span class="string">"name"</span> : <span class="string">"age"</span>,</span><br><span class="line">				<span class="string">"type"</span> : <span class="string">"bar"</span>,</span><br><span class="line">				<span class="string">"data"</span> : ages</span><br><span class="line">			&#125; ]</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 将配置项赋给chart对象，来显示相关的数据</span></span><br><span class="line">		mychart.setOption(option);</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">	</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">marquee</span>&gt;</span>确认可以到达这里啊<span class="tag">&lt;/<span class="name">marquee</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="演示结果"><a href="#演示结果" class="headerlink" title="演示结果"></a>演示结果</h3><p>至此，编码任务就算完成了。那么迫不及待的来看看效果吧。<br><img src="http://img.blog.csdn.net/20161020181134402" alt="效果演示图"></p>
<p>那么，稍微的修改一下数据，再来看看结果会怎样，刷新之后如下图：<br><img src="http://img.blog.csdn.net/20161020181254451" alt="更新的数据结果"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>最后来回顾一下，本次试验的收获。其实也就是对于ECharts的一个比较“全栈”（请允许我用了这么个不太恰当的词    O(∩_∩)O    ） 。比较简单的实现了后端以及前端的数据可视化显示的一个流程。</p>
<p>用到的技术也都是很大众化的了，当然后端不仅可以由PHP来完成，JAVA，Python，Golang等等都是可以的，只是使用PHP比较方便罢了。只要可以根据这个接口获取到想要的数据就行。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://guoruibiao.github.io/2016/10/20/ECharts-In-Project/" data-id="ciwn7l610000dksu1cjc9lkj6" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Ajax/">Ajax</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ECharts/">ECharts</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JQuery/">JQuery</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/">MySQL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP/">PHP</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Interpreter-In-Command-Line" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/29/Interpreter-In-Command-Line/" class="article-date">
  <time datetime="2016-09-29T06:37:09.000Z" itemprop="datePublished">2016-09-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/29/Interpreter-In-Command-Line/">Interpreter In Command Line</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<p>昨天看到一篇关于Linux下的桌面词典的文章，于是就想实现一个Windows命令行下的翻译软件。下面，我将一步步的来实现这个简单的小软件。</p>
<hr>
<h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><p>按照瀑布开发模型，需要进行一些列的流程，在这里由于是博主自己使用，所以就省略了需求分析，系统设计，编码设计这些阶段，直奔主题了。</p>
<h3 id="素材"><a href="#素材" class="headerlink" title="素材"></a>素材</h3><p>博主本次试验的环境大致如下：</p>
<ul>
<li>操作系统： Windows 7 64位</li>
<li>编程语言：Python （版本2.7.11）</li>
<li>IDE： PyCharm 专业版</li>
</ul>
<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><p>如上，根据实验环境，所需的依赖就不难理解了。不过除了接口，也没有用到什么第三方的库。所以依赖也是很简单的了。就是百度翻译的公共API接口。待会再介绍。</p>
<h2 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h2><p>至于什么是接口。与其说是一种规范，我个人觉得对咱们开发者而言，了解怎么使用就可以了，所以把它当做是一个函数就可以了。我们传给这个接口一些参数，然后处理返回的结果。这就可以了！够白话了吧:-)</p>
<h3 id="地址"><a href="#地址" class="headerlink" title="地址"></a>地址</h3><p>本次试验，依赖的接口是国内互联网公司三巨头之一的百度的一个公共的翻译接口。如下：<br><a href="http://fanyi.baidu.com/v2transapi" target="_blank" rel="external">http://fanyi.baidu.com/v2transapi</a></p>
<p>待会通过get的方式或者post的方式进行与服务器的交互，就能完成今天的实验了。</p>
<h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 执行文本翻译</span></span><br><span class="line"><span class="meta"># query 要翻译的文本</span></span><br><span class="line"><span class="meta"># from 原语言语种 默认:中文</span></span><br><span class="line"><span class="meta"># to 目标语种 默认:英文</span></span><br></pre></td></tr></table></figure>
<p>如上，了解了这三个参数就足够了。</p>
<h3 id="返回值解析"><a href="#返回值解析" class="headerlink" title="返回值解析"></a>返回值解析</h3><p>我这里模拟请求了一下服务器，获得了其返回的一串JSON数据。大致的串如下：<br><img src="http://img.blog.csdn.net/20160929141419509" alt="返回JSON串"></p>
<h2 id="编码及测试"><a href="#编码及测试" class="headerlink" title="编码及测试"></a>编码及测试</h2><p>现在万事俱备，只欠一个能编码的程序员了。:-)</p>
<p>Python处理JSON串简直是酸爽，特别的快速！</p>
<h3 id="功能代码"><a href="#功能代码" class="headerlink" title="功能代码"></a>功能代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">'utf8'</span>)</span><br><span class="line"><span class="comment">#    __author__ = '郭 璞'</span></span><br><span class="line"><span class="comment">#    __date__ = '2016/9/29'</span></span><br><span class="line"><span class="comment">#    __Desc__ = 实现命令行下的翻译程序实现</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> urllib2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getHtml</span><span class="params">(type=True, text=<span class="string">'English'</span>)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> type:</span><br><span class="line">        translate_url = <span class="string">"http://fanyi.baidu.com/v2transapi?query=%s"</span>%text</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        translate_url = <span class="string">"http://fanyi.baidu.com/v2transapi?from=zh&amp;to=en&amp;query=%s"</span> % text</span><br><span class="line">    data = urlopen(translate_url).read()</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 这里使用encode为gbk的方式是为了在Windows的DOS界面下不发生乱码的情况</span></span><br><span class="line">    flag = raw_input(<span class="string">"英文转汉语输入1，汉语转英文输入0："</span>.encode(<span class="string">'gbk'</span>)).encode(<span class="string">'utf8'</span>)</span><br><span class="line">    <span class="comment"># 应该考虑到windows 的DOS界面下输入的字符编码为gbk，要想被代码正确的用utf-8解码，首先先用gbk解码，还原为愿字符</span></span><br><span class="line">    querytext = raw_input(<span class="string">"请输入您想查询的内容\n"</span>.encode(<span class="string">'gbk'</span>)).decode(<span class="string">'gbk'</span>)</span><br><span class="line">    <span class="keyword">if</span> flag == <span class="number">1</span>:</span><br><span class="line">        data = getHtml(type=<span class="keyword">False</span>, text=querytext)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        data = getHtml(text=querytext)</span><br><span class="line">    data = json.loads(data)</span><br><span class="line">    <span class="comment"># 分析json数据串，定向的获取到相应的解释信息</span></span><br><span class="line">    <span class="comment"># 首先打印出单词的简单含义</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"\n翻译结果:"</span>.encode(<span class="string">"gbk"</span>)</span><br><span class="line">    <span class="keyword">print</span> data[<span class="string">'trans_result'</span>][<span class="string">'data'</span>][<span class="number">0</span>][<span class="string">'dst'</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">   main()</span><br></pre></td></tr></table></figure>
<h3 id="运行脚本"><a href="#运行脚本" class="headerlink" title="运行脚本"></a>运行脚本</h3><p>为了能直接的在命令行下使用，就得在环境变量里面进行一下设置了。不然，每次都得到这个文件路径下，那样岂不是很麻烦，这很明显不符合Pythonic的风格嘛。<br>于是写了一个脚本：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@echo</span> off</span><br><span class="line">python <span class="string">D:</span><span class="regexp">/mycommand/</span>translate.py</span><br></pre></td></tr></table></figure>
<p>是不是超简单呢？</p>
<h3 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h3><p>接下来就是把这个批命令bat文件的路径添加到环境变量中了。为了引起不必要的麻烦，我添加到了当前用户的环境变量中，这样就算是以后要更改，也不会影响到系统的环境变量了。</p>
<p>具体的方法，网上有很多参考资料，这里不过多的进行阐述了。</p>
<h2 id="结果展示"><a href="#结果展示" class="headerlink" title="结果展示"></a>结果展示</h2><p>最激动人心的时刻，到了。下面你将看到命令行下的精彩的世界。完善了上面步骤，就拥有了一个命令行下的翻译软件咯。:-)</p>
<h3 id="英语转汉语"><a href="#英语转汉语" class="headerlink" title="英语转汉语"></a>英语转汉语</h3><p><img src="http://img.blog.csdn.net/20160929142446497" alt="english2Chinese"></p>
<h3 id="汉语转英语"><a href="#汉语转英语" class="headerlink" title="汉语转英语"></a>汉语转英语</h3><p><img src="http://img.blog.csdn.net/20160929142535279" alt="Chinese2english"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>最后，来总结一下本次试验。</p>
<p>代码难度一般般，也可以说很简单了。就是些基础的Python内置模块的使用，额外需要掌握的就是接口，以及接口的使用等知识了。</p>
<p>另外，本实验可拓展性很强，因为这个接口内部又可以判断源语言的类属的功能，也就是说我们可以完成更加智能的翻译实现。不管什么语言，都可以被翻译，如果要指定目标语言的话，加个参数就即可。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://guoruibiao.github.io/2016/09/29/Interpreter-In-Command-Line/" data-id="ciwn7l616000iksu1w35s7zq4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python处理JSON/">Python处理JSON</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WindowsDOS翻译/">WindowsDOS翻译</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-OpenCV-Python-实现画板小工具" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/14/OpenCV-Python-实现画板小工具/" class="article-date">
  <time datetime="2016-09-14T08:55:03.000Z" itemprop="datePublished">2016-09-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/14/OpenCV-Python-实现画板小工具/">OpenCV+Python 实现画板小工具</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>首先声明一下，本例思路不是博主原创，博主在前人的代码上进行了个性化的修改，制作了一个简单的画图工具。下面附上自己的理解，与君共勉。</p>
<hr>
<h2 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h2><p><img src="http://img.blog.csdn.net/20160914164037144" alt="画板效果图"></p>
<h2 id="画图工具实现"><a href="#画图工具实现" class="headerlink" title="画图工具实现"></a>画图工具实现</h2><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">'utf8'</span>)</span><br><span class="line"><span class="comment">#    __author__ = '郭 璞'</span></span><br><span class="line"><span class="comment">#    __date__ = '2016/9/14'</span></span><br><span class="line"><span class="comment">#    __Desc__ = opencv实现的画板</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">blankcallback</span><span class="params">(position)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'滚动条当前位置为%d'</span>%position</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当鼠标按下时设置 要进行绘画</span></span><br><span class="line">drawing = <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果mode为True时就画矩形，按下‘m'变为绘制曲线</span></span><br><span class="line">mode = <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># globalx, globaly = -1,-1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建回调函数，用于设置滚动条的位置</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">drawcircle</span><span class="params">(event,x,y,flags,param)</span>:</span></span><br><span class="line">    r = cv2.getTrackbarPos(<span class="string">'R'</span>,<span class="string">'image'</span>)</span><br><span class="line">    g = cv2.getTrackbarPos(<span class="string">'G'</span>,<span class="string">'image'</span>)</span><br><span class="line">    b = cv2.getTrackbarPos(<span class="string">'B'</span>,<span class="string">'image'</span>)</span><br><span class="line">    color = (b,g,r)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">global</span> globalx,globaly,drawing,mode</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 当按下左键时，返回起始的位置坐标</span></span><br><span class="line">    <span class="keyword">if</span> event == cv2.EVENT_LBUTTONDOWN:</span><br><span class="line">        drawing = <span class="keyword">True</span></span><br><span class="line">        <span class="comment"># globaly,globaly = x,y</span></span><br><span class="line">    <span class="comment"># 当鼠标左键按下并移动则是绘画圆形，event可以查看移动，flag查看是否按下</span></span><br><span class="line">    <span class="keyword">elif</span> event == cv2.EVENT_MOUSEMOVE <span class="keyword">and</span> flags == cv2.EVENT_FLAG_LBUTTON:</span><br><span class="line">        <span class="keyword">if</span> drawing == <span class="keyword">True</span>:</span><br><span class="line">            <span class="keyword">if</span> mode == <span class="keyword">True</span>:</span><br><span class="line">                <span class="comment"># cv2.rectangle(img,(globalx,globaly),(x,y),color,-1)</span></span><br><span class="line">                cv2.rectangle(img, (x,y), (x, y), color, <span class="number">-1</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 绘制圆圈，小圆点连接在一起成为线，1代表了比划的粗细</span></span><br><span class="line">                cv2.circle(img,(x,y),<span class="number">1</span>,color,<span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">elif</span> event == cv2.EVENT_LBUTTONUP:</span><br><span class="line">            drawing = <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line">img = cv2.imread(<span class="string">'me.jpg'</span>)</span><br><span class="line">cv2.namedWindow(<span class="string">'image'</span>,cv2.WINDOW_NORMAL)</span><br><span class="line"></span><br><span class="line">cv2.createTrackbar(<span class="string">'R'</span>,<span class="string">'image'</span>,<span class="number">0</span>,<span class="number">255</span>,blankcallback)</span><br><span class="line">cv2.createTrackbar(<span class="string">'G'</span>,<span class="string">'image'</span>,<span class="number">0</span>,<span class="number">255</span>,blankcallback)</span><br><span class="line">cv2.createTrackbar(<span class="string">'B'</span>,<span class="string">'image'</span>,<span class="number">0</span>,<span class="number">255</span>,blankcallback)</span><br><span class="line">cv2.setMouseCallback(<span class="string">'image'</span>,drawcircle)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    cv2.imshow(<span class="string">'image'</span>,img)</span><br><span class="line"></span><br><span class="line">    key = cv2.waitKey(<span class="number">10</span>)&amp;<span class="number">0xFFF</span></span><br><span class="line">    <span class="keyword">if</span> key == ord(<span class="string">'m'</span>):</span><br><span class="line">        mode = <span class="keyword">not</span> mode</span><br><span class="line">    <span class="keyword">elif</span> key == <span class="number">27</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>
<h3 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h3><p>在程序正常的跑起来之后，我们会用鼠标来改变滚动条的位置，这个时候就会触发滚动条内置的回调函数，在这里是<code>blankcallback函数</code>。因此我们可以在命令行中看到打印出的值。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">D:\Software\Python2\python<span class="selector-class">.exe</span> E:/Code/Python/DataStructor/opencv/PaintBoard<span class="selector-class">.py</span></span><br><span class="line">滚动条当前位置为<span class="number">1</span></span><br><span class="line">滚动条当前位置为<span class="number">0</span></span><br><span class="line">滚动条当前位置为<span class="number">5</span></span><br><span class="line">滚动条当前位置为<span class="number">10</span></span><br><span class="line">滚动条当前位置为<span class="number">17</span></span><br><span class="line">滚动条当前位置为<span class="number">28</span></span><br><span class="line">···</span><br><span class="line">···</span><br><span class="line">滚动条当前位置为<span class="number">202</span></span><br><span class="line">滚动条当前位置为<span class="number">206</span></span><br><span class="line">滚动条当前位置为<span class="number">219</span></span><br><span class="line">滚动条当前位置为<span class="number">223</span></span><br><span class="line">滚动条当前位置为<span class="number">233</span></span><br><span class="line">滚动条当前位置为<span class="number">238</span></span><br><span class="line">滚动条当前位置为<span class="number">240</span></span><br><span class="line">滚动条当前位置为<span class="number">242</span></span><br><span class="line">滚动条当前位置为<span class="number">250</span></span><br><span class="line">滚动条当前位置为<span class="number">253</span></span><br><span class="line">滚动条当前位置为<span class="number">255</span></span><br><span class="line"></span><br><span class="line">滚动条当前位置为<span class="number">0</span></span><br><span class="line"></span><br><span class="line">Process finished with exit <span class="selector-tag">code</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
<h2 id="程序分析"><a href="#程序分析" class="headerlink" title="程序分析"></a>程序分析</h2><p>本例中注释很清晰，基本上只需要对一些小技巧方面做些解释即可。</p>
<h3 id="窗体自由度"><a href="#窗体自由度" class="headerlink" title="窗体自由度"></a>窗体自由度</h3><p>默认创建的窗体大小不能改变，但是我们可以指定让其可以被自适应的改变。</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># 第二个参数即可达到我们想要的窗体自适应的效果</span></span><br><span class="line">cv2.namedWindow(<span class="string">'image'</span>,cv2.WINDOW_NORMAL)</span><br></pre></td></tr></table></figure>
<h3 id="如何退出程序"><a href="#如何退出程序" class="headerlink" title="如何退出程序"></a>如何退出程序</h3><p>想必明眼的你已经看到：</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    cv2.imshow(<span class="comment">'image',img)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">key</span> = cv2.waitKey(<span class="number">10</span>)&amp;<span class="number">0xFFF</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">key</span> == ord(<span class="comment">'m'):</span></span><br><span class="line">        mode = <span class="keyword">not</span> mode</span><br><span class="line">    elif <span class="keyword">key</span> == <span class="number">27</span>:</span><br><span class="line">        break</span><br></pre></td></tr></table></figure>
<p>这段代码的作用就是计算当前 键盘被按下的键的ASCII码的值，如果等于ESC键对应的值，说明要退出循环了。</p>
<h3 id="滚动条相关"><a href="#滚动条相关" class="headerlink" title="滚动条相关"></a>滚动条相关</h3><p>滚动条无非也就是创建和获取当前的滚动条的位置。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 参数分别为： 滚动条的名称，附着的窗体的名称，默认初始位置，最大长度，回调函数</span><br><span class="line"><span class="selector-tag">cv2</span><span class="selector-class">.createTrackbar</span>(<span class="string">'R'</span>,<span class="string">'image'</span>,<span class="number">0</span>,<span class="number">255</span>,blankcallback)</span><br><span class="line"><span class="selector-tag">cv2</span><span class="selector-class">.createTrackbar</span>(<span class="string">'G'</span>,<span class="string">'image'</span>,<span class="number">0</span>,<span class="number">255</span>,blankcallback)</span><br><span class="line"><span class="selector-tag">cv2</span><span class="selector-class">.createTrackbar</span>(<span class="string">'B'</span>,<span class="string">'image'</span>,<span class="number">0</span>,<span class="number">255</span>,blankcallback)</span><br><span class="line"># 这里也有一个回调函数，只不过是针对于鼠标的回调函数</span><br><span class="line"><span class="selector-tag">cv2</span><span class="selector-class">.setMouseCallback</span>(<span class="string">'image'</span>,drawcircle)</span><br></pre></td></tr></table></figure>
<p>里面的<code>blankcallback</code>回调函数是针对滚动条的一个回调函数，这里不需要做什么处理，仅仅是打印输出一些当前被操作的滚动条的位置而已。</p>
<p>而获取到相应的位置值也很方便。</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">r</span> = cv2.getTrackbarPos(<span class="string">'R'</span>,<span class="string">'image'</span>)</span><br><span class="line"><span class="attr">g</span> = cv2.getTrackbarPos(<span class="string">'G'</span>,<span class="string">'image'</span>)</span><br><span class="line"><span class="attr">b</span> = cv2.getTrackbarPos(<span class="string">'B'</span>,<span class="string">'image'</span>)</span><br><span class="line"><span class="comment"># 接下来会用于设置图层上画笔的颜色</span></span><br><span class="line"><span class="attr">color</span> = (b,g,r)</span><br></pre></td></tr></table></figure>
<h3 id="支持的事件"><a href="#支持的事件" class="headerlink" title="支持的事件"></a>支持的事件</h3><p>因为是鼠标事件的监听，所以需要知道 系统支持哪些事件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 首先查看一下被支持的鼠标事件，以方便于进一步的操作</span></span><br><span class="line">events = [i <span class="keyword">for</span> i <span class="keyword">in</span> dir(cv2) <span class="keyword">if</span> <span class="string">'EVENT'</span> <span class="keyword">in</span> i]</span><br><span class="line"><span class="built_in">print</span> events</span><br></pre></td></tr></table></figure>
<p>输出结果为：</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">'EVENT_FLAG_ALTKEY</span>', <span class="symbol">'EVENT_FLAG_CTRLKEY</span>', <span class="symbol">'EVENT_FLAG_LBUTTON</span>', <span class="symbol">'EVENT_FLAG_MBUTTON</span>', <span class="symbol">'EVENT_FLAG_RBUTTON</span>', <span class="symbol">'EVENT_FLAG_SHIFTKEY</span>', <span class="symbol">'EVENT_LBUTTONDBLCLK</span>', <span class="symbol">'EVENT_LBUTTONDOWN</span>', <span class="symbol">'EVENT_LBUTTONUP</span>', <span class="symbol">'EVENT_MBUTTONDBLCLK</span>', <span class="symbol">'EVENT_MBUTTONDOWN</span>', <span class="symbol">'EVENT_MBUTTONUP</span>', <span class="symbol">'EVENT_MOUSEMOVE</span>', <span class="symbol">'EVENT_RBUTTONDBLCLK</span>', <span class="symbol">'EVENT_RBUTTONDOWN</span>', <span class="symbol">'EVENT_RBUTTONUP</span>']</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://guoruibiao.github.io/2016/09/14/OpenCV-Python-实现画板小工具/" data-id="ciwn7l62k0012ksu1vndk88iq" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OpenCV/">OpenCV</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/画板小工具/">画板小工具</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-唉，都是摄像头惹的祸" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/09/唉，都是摄像头惹的祸/" class="article-date">
  <time datetime="2016-09-09T05:53:26.000Z" itemprop="datePublished">2016-09-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/09/唉，都是摄像头惹的祸/">唉，都是摄像头惹的祸:(</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<p>先上个福利图 :)</p>
<p><img src="http://img.blog.csdn.net/20160908200336628" alt="镇楼图"></p>
<p>首先说一下，写这篇博客的原因。大致可为以下几点：</p>
<ul>
<li>新买的android手机掉在了地上，摄像头摔得不能聚焦了，卖家还不给维修 :(</li>
<li>手头有一个老旧的Iphone，然而不会IOS开发，所以决定使用网页形式来替代</li>
<li><p>写博客需要一些手绘的流程图或者示意图，而电脑上的作图工具用起来不是很顺手。</p>
<p>综合上面的原因，就为自己写了一个解决没有高清照片问题的php网页，用来转储Iphone拍摄的照片，用于博客的书写。</p>
</li>
</ul>
<hr>
<h2 id="上传代码"><a href="#上传代码" class="headerlink" title="上传代码"></a>上传代码</h2><p>正好博主本人电脑上配置好了PHP+Apache+MySQL的环境，当然了。使用Java或者Python或者其他的语言也是可以的，配置好相关的环境就可以了。 </p>
<p>为了尽可能使这次的工作量最少，最简单，这里使用了PHP作为了我的开发语言。另本次试验的核心是图片的转储，于是也没有添加数据库的上传记录，这些东西也就是自己用，实际的开发中，各方面都得做的完善一点，谨慎一点的。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">header(<span class="string">"Content-Type:text/html;charset=utf-8"</span>);</span><br><span class="line">$path = <span class="string">"F:/phpimage/"</span>;</span><br><span class="line"></span><br><span class="line">$imgtype=$_REQUEST[<span class="string">'imgtype'</span>];</span><br><span class="line"></span><br><span class="line">$rand_number = rand(<span class="number">1</span>,<span class="number">100000</span>);</span><br><span class="line">$server_name = $imgtype==<span class="string">"notgif"</span>?$path.<span class="string">"$rand_number"</span>.<span class="string">".png"</span>:$path.<span class="string">"$rand_number."</span>.$imgtype;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_FILES[<span class="string">'photo'</span>][<span class="string">'error'</span>]&gt;<span class="number">0</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"上传文件出错了！"</span>.$_FILES[<span class="string">'photo'</span>][<span class="string">'error'</span>]);	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(move_uploaded_file($_FILES[<span class="string">'photo'</span>][<span class="string">'tmp_name'</span>],$server_name))&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">'&lt;br&gt;&lt;br&gt;&lt;span class="label label-success"&gt;上传成功&lt;/span&gt;'</span>;</span><br><span class="line">  <span class="comment">//header("location:./upimg.php");</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">'&lt;br&gt;&lt;br&gt;&lt;span class="label label-danger"&gt;上传失败&lt;/span&gt;'</span>;</span><br><span class="line">  <span class="comment">//header("location:./upimg.php");</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>这里就简单的让用户决定自己上传的文件，博主有时候写博客经常会用到gif图，所以单纯的将文件转储为png，那是不够的。于是我就添加了一个gif图上传的选项。至于其他类型的图片，全部一棍子“打死”，转成png图片类型即可。</p>
<h2 id="适配"><a href="#适配" class="headerlink" title="适配"></a>适配</h2><p>由于博主是为了自己图片转储的需要，所以该网页工作的主要是在手机上。那么问题就自然的来了，那就是PC版的网页在手机上显示的话会很丑。</p>
<p>为了让博主自己使用起来也稍微的愉悦一点，做点手机端的适配也是很有必要的啦。</p>
<p>同样的，为了简便。博主使用了Bootstrap来制作前端界面了。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/1999/xhtml"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=utf-8"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 引入 Bootstrap --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"http://cdn.static.runoob.com/libs/bootstrap/3.3.7/css/bootstrap.min.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>上传图片<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line">    <span class="selector-tag">div</span> &#123;</span><br><span class="line">		<span class="attribute">width</span>:<span class="number">88%</span>;</span><br><span class="line">		<span class="attribute">height</span>:auto;</span><br><span class="line">		<span class="attribute">background</span>:silver;	</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-tag">input</span> <span class="selector-tag">label</span>&#123;</span><br><span class="line">        <span class="attribute">width</span>:<span class="number">100%</span>;</span><br><span class="line">        <span class="attribute">height</span>:auto;    </span><br><span class="line">    &#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container-fluid"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">marquee</span> <span class="attr">behavior</span>=<span class="string">"alternate"</span>  <span class="attr">class</span>=<span class="string">"label label-info"</span>&gt;</span>上传图片吧<span class="tag">&lt;/<span class="name">marquee</span>&gt;</span> <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">role</span>=<span class="string">"form"</span> <span class="attr">action</span>=<span class="string">"./upimg.php"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"btn btn-default"</span>  <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"photo"</span>  /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"label label-warning"</span>&gt;</span>图片类型<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"imgtype"</span> <span class="attr">value</span>=<span class="string">"notgif"</span> <span class="attr">checked</span>=<span class="string">"checked"</span>&gt;</span>非gif图&amp;nbsp;&amp;nbsp;</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"imgtype"</span> <span class="attr">value</span>=<span class="string">"gif"</span> /&gt;</span>gif图<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"btn btn-default"</span> <span class="attr">style</span>=<span class="string">"background:#C6C"</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"上传图片"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>其实html代码和php代码是写在一个文件中的，待会博主还会贴出全部的代码。</p>
<h2 id="自动化"><a href="#自动化" class="headerlink" title="自动化"></a>自动化</h2><p>刚才博主已经提到了，网页主要是工作在手机端的，那么自然的我们就不能采用单纯的PC端使用的localhost了。那么怎么实现呢？</p>
<p>答案就是使用IP进行连接。形如：</p>
<blockquote>
<p><a href="http://192.168.56.245/upimg.php" target="_blank" rel="external">http://192.168.56.245/upimg.php</a></p>
</blockquote>
<p>在进行手机端测试的时候，博主每次都需要到电脑的命令行下手动的输入<br><code>ipconfig /all</code><br>然后用鼠标往上翻，找到无线适配那一块，如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">无线局域网适配器 无线网络连接:</span><br><span class="line"></span><br><span class="line">   连接特定的 <span class="selector-tag">DNS</span> 后缀 . . . . . . . : <span class="selector-tag">dlut</span><span class="selector-class">.edu</span><span class="selector-class">.cn</span></span><br><span class="line">   本地链接 <span class="selector-tag">IPv6</span> 地址. . . . . . . . : <span class="selector-tag">fe80</span><span class="selector-pseudo">::1d9f</span><span class="selector-pseudo">:d97b</span><span class="selector-pseudo">:fd16</span><span class="selector-pseudo">:1f6f</span>%12</span><br><span class="line">   <span class="selector-tag">IPv4</span> 地址 . . . . . . . . . . . . : 192<span class="selector-class">.168</span><span class="selector-class">.56</span><span class="selector-class">.245</span></span><br><span class="line">   子网掩码  . . . . . . . . . . . . : 255<span class="selector-class">.255</span><span class="selector-class">.252</span><span class="selector-class">.0</span></span><br><span class="line">   默认网关. . . . . . . . . . . . . : 192<span class="selector-class">.168</span><span class="selector-class">.56</span><span class="selector-class">.1</span></span><br></pre></td></tr></table></figure>
<p>唉，每次都要这么麻烦，博主也是忒懒，于是就想写个程序来一键获取本机的IP地址，然后就会方便很多了。</p>
<p>说到这里，博主想了不少方法，Java啊，C语言，C++, Python，甚至C#写个界面什么的，但是为了保持博主一贯的优雅，简洁（其实是懒惰）的风格，博主还是采用了最为基础的方式，那就是写一个批命令的脚本，来一键获取本机的IP地址。</p>
<p>代码也比较简单，就是对命令中的返回结果的过滤。</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="keyword">for</span> /f "tokens=<span class="number">4</span>" <span class="variable">%%a</span> <span class="keyword">in</span> ('route <span class="built_in">print</span>^|<span class="built_in">findstr</span> <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.*<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>') <span class="keyword">do</span> (</span><br><span class="line"> <span class="built_in">set</span> IP=<span class="variable">%%a</span></span><br><span class="line">)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">%IP%</span></span><br><span class="line"><span class="built_in">pause</span></span><br></pre></td></tr></table></figure>
<p><img src="http://img.blog.csdn.net/20160908202152525" alt="一键获取本机IP"></p>
<h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><p>首先是upimg.php</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/1999/xhtml"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=utf-8"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 引入 Bootstrap --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"http://cdn.static.runoob.com/libs/bootstrap/3.3.7/css/bootstrap.min.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>上传图片<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line">    <span class="selector-tag">div</span> &#123;</span><br><span class="line">		<span class="attribute">width</span>:<span class="number">88%</span>;</span><br><span class="line">		<span class="attribute">height</span>:auto;</span><br><span class="line">		<span class="attribute">background</span>:silver;	</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-tag">input</span> <span class="selector-tag">label</span>&#123;</span><br><span class="line">        <span class="attribute">width</span>:<span class="number">100%</span>;</span><br><span class="line">        <span class="attribute">height</span>:auto;    </span><br><span class="line">    &#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container-fluid"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">marquee</span> <span class="attr">behavior</span>=<span class="string">"alternate"</span>  <span class="attr">class</span>=<span class="string">"label label-info"</span>&gt;</span>上传图片吧<span class="tag">&lt;/<span class="name">marquee</span>&gt;</span> <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">role</span>=<span class="string">"form"</span> <span class="attr">action</span>=<span class="string">"./upimg.php"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"btn btn-default"</span>  <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"photo"</span>  /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"label label-warning"</span>&gt;</span>图片类型<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"imgtype"</span> <span class="attr">value</span>=<span class="string">"notgif"</span> <span class="attr">checked</span>=<span class="string">"checked"</span>&gt;</span>非gif图&amp;nbsp;&amp;nbsp;</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"imgtype"</span> <span class="attr">value</span>=<span class="string">"gif"</span> /&gt;</span>gif图<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"btn btn-default"</span> <span class="attr">style</span>=<span class="string">"background:#C6C"</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"上传图片"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="php"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">header(<span class="string">"Content-Type:text/html;charset=utf-8"</span>);</span><br><span class="line">$path = <span class="string">"F:/phpimage/"</span>;</span><br><span class="line"></span><br><span class="line">$imgtype=$_REQUEST[<span class="string">'imgtype'</span>];</span><br><span class="line"></span><br><span class="line">$rand_number = rand(<span class="number">1</span>,<span class="number">100000</span>);</span><br><span class="line">$server_name = $imgtype==<span class="string">"notgif"</span>?$path.<span class="string">"$rand_number"</span>.<span class="string">".png"</span>:$path.<span class="string">"$rand_number."</span>.$imgtype;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_FILES[<span class="string">'photo'</span>][<span class="string">'error'</span>]&gt;<span class="number">0</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"上传文件出错了！"</span>.$_FILES[<span class="string">'photo'</span>][<span class="string">'error'</span>]);	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(move_uploaded_file($_FILES[<span class="string">'photo'</span>][<span class="string">'tmp_name'</span>],$server_name))&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">'&lt;br&gt;&lt;br&gt;&lt;span class="label label-success"&gt;上传成功&lt;/span&gt;'</span>;</span><br><span class="line">  <span class="comment">//header("location:./upimg.php");</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">'&lt;br&gt;&lt;br&gt;&lt;span class="label label-danger"&gt;上传失败&lt;/span&gt;'</span>;</span><br><span class="line">  <span class="comment">//header("location:./upimg.php");</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后是一键获取本机IP的代码：</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> "当前，您的电脑所在的局域网内的IP地址为："</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> /f "tokens=<span class="number">4</span>" <span class="variable">%%a</span> <span class="keyword">in</span> ('route <span class="built_in">print</span>^|<span class="built_in">findstr</span> <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.*<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>') <span class="keyword">do</span> (</span><br><span class="line"> <span class="built_in">set</span> IP=<span class="variable">%%a</span></span><br><span class="line">)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">%IP%</span></span><br><span class="line"><span class="built_in">pause</span></span><br></pre></td></tr></table></figure>
<p>最后一个pause不能少，除非你想看到一个黑色的框框一闪而逝  :-)</p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><h3 id="Android端"><a href="#Android端" class="headerlink" title="Android端"></a>Android端</h3><h4 id="上传"><a href="#上传" class="headerlink" title="上传"></a>上传</h4><ul>
<li>选择好一张图片，待上传。</li>
</ul>
<p><img src="http://img.blog.csdn.net/20160908195347233" alt="选择号文件待上传"></p>
<h4 id="上传结果"><a href="#上传结果" class="headerlink" title="上传结果"></a>上传结果</h4><ul>
<li>上传完毕</li>
</ul>
<p><img src="http://img.blog.csdn.net/20160908195510750" alt="上传完毕"></p>
<h3 id="Iphone"><a href="#Iphone" class="headerlink" title="Iphone"></a>Iphone</h3><p>Iphone端的适配就比较简单了，毕竟种类有限嘛。</p>
<h4 id="上传-1"><a href="#上传-1" class="headerlink" title="上传"></a>上传</h4><p><img src="http://img.blog.csdn.net/20160909090547104" alt="iphone上传待完成"></p>
<h4 id="上传结果-1"><a href="#上传结果-1" class="headerlink" title="上传结果"></a>上传结果</h4><p><img src="http://img.blog.csdn.net/20160909090607630" alt="Iphone上传完成结果"></p>
<h3 id="服务器端情况"><a href="#服务器端情况" class="headerlink" title="服务器端情况"></a>服务器端情况</h3><p>最后，来查看一下。服务器端有没有上传完成的图片信息。可以看到本次试验上传的所有的图片，而且如果上传的图片为gif图的话，也是可以直接可以满足的，图片的质量并没有被损坏。 :-)</p>
<p><img src="http://img.blog.csdn.net/20160909090640286" alt="服务器端图片库"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>经过了本次试验，博主也明白了一个道理，那就是“工具都是被懒逼着创造出来的”。 不管怎样，也算是复习了一些基础性的知识，外加一点点的应用吧。</p>
<p>基础知识是今后进步的源动力，不该忽视的干粮。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://guoruibiao.github.io/2016/09/09/唉，都是摄像头惹的祸/" data-id="ciwn7l67a005cksu1hld4in1u" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP图片上传/">PHP图片上传</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/一键获取IP/">一键获取IP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/适配移动端/">适配移动端</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-OpenCV-Python-实现人脸识别" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/06/OpenCV-Python-实现人脸识别/" class="article-date">
  <time datetime="2016-09-06T12:32:23.000Z" itemprop="datePublished">2016-09-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/06/OpenCV-Python-实现人脸识别/">OpenCV Python 实现人脸识别</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<p>下午的时候，配好了OpenCV的Python环境，<a href="http://blog.csdn.net/marksinoberg/article/details/52442229" target="_blank" rel="external">OpenCV的Python环境搭建</a>。于是迫不及待的想体验一下opencv的人脸识别，如下文。</p>
<hr>
<h2 id="必备知识"><a href="#必备知识" class="headerlink" title="必备知识"></a>必备知识</h2><h3 id="Haar-like"><a href="#Haar-like" class="headerlink" title="Haar-like"></a>Haar-like</h3><p><a href="http://zhidao.baidu.com/link?url=HwSPcYX562OqXIEd3ccYPbky22tLAWJXuF2H33QE0VS9eI-cxfAQy-W0skQQ7SzTQJ1zTj0OX0IsB6LijOxFA_" target="_blank" rel="external">Haar-like百科释义</a>。通俗的来讲，就是作为人脸特征即可。</p>
<blockquote>
<p>Haar特征值反映了图像的灰度变化情况。例如：脸部的一些特征能由矩形特征简单的描述，如：眼睛要比脸颊颜色要深，鼻梁两侧比鼻梁颜色要深，嘴巴比周围颜色要深等。</p>
</blockquote>
<h3 id="opencv-api"><a href="#opencv-api" class="headerlink" title="opencv api"></a>opencv api</h3><p>要想使用opencv，就必须先知道其能干什么，怎么做。于是API的重要性便体现出来了。就本例而言，使用到的函数很少，也就普通的读取图片，灰度转换，显示图像，简单的编辑图像罢了。</p>
<p>如下：</p>
<h4 id="读取图片"><a href="#读取图片" class="headerlink" title="读取图片"></a>读取图片</h4><p>只需要给出待操作的图片的路径即可。<br><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="title">image</span> = cv2.imread(imagepath)</span><br></pre></td></tr></table></figure></p>
<h4 id="灰度转换"><a href="#灰度转换" class="headerlink" title="灰度转换"></a>灰度转换</h4><p>灰度转换的作用就是：转换成灰度的图片的计算强度得以降低。</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line">gray = cv2.cvtColor(image,cv2.COLOR_BGR2GRAY)</span><br></pre></td></tr></table></figure>
<h4 id="画图"><a href="#画图" class="headerlink" title="画图"></a>画图</h4><p>opencv 的强大之处的一个体现就是其可以对图片进行任意编辑，处理。<br>下面的这个函数最后一个参数指定的就是画笔的大小。<br><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line">cv2.rectangle(image,(<span class="keyword">x</span>,y),(<span class="keyword">x</span>+<span class="keyword">w</span>,y+<span class="keyword">w</span>),(<span class="number">0</span>,<span class="number">255</span>,<span class="number">0</span>),<span class="number">2</span>)</span><br></pre></td></tr></table></figure></p>
<h4 id="显示图像"><a href="#显示图像" class="headerlink" title="显示图像"></a>显示图像</h4><p>编辑完的图像要么直接的被显示出来，要么就保存到物理的存储介质。</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="title">cv2</span>.imshow(<span class="string">"Image Title"</span>,image)</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="获取人脸识别训练数据"><a href="#获取人脸识别训练数据" class="headerlink" title="获取人脸识别训练数据"></a>获取人脸识别训练数据</h4><p>看似复杂，其实就是对于人脸特征的一些描述，这样opencv在读取完数据后很据训练中的样品数据，就可以感知读取到的图片上的特征，进而对图片进行人脸识别。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"></span><br><span class="line">face_cascade = cv2.CascadeClassifier(<span class="string">r'./haarcascade_frontalface_default.xml'</span>)</span><br></pre></td></tr></table></figure>
<p>里卖弄的这个xml文件，就是opencv在GitHub上共享出来的具有普适的训练好的数据。我们可以直接的拿来使用。</p>
<p><a href="https://github.com/opencv/opencv/tree/master/data/haarcascades" target="_blank" rel="external">训练数据 参考地址</a></p>
<h4 id="探测人脸"><a href="#探测人脸" class="headerlink" title="探测人脸"></a>探测人脸</h4><p>说白了，就是根据训练的数据来对新图片进行识别的过程。</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">import</span> cv2</span><br><span class="line"></span><br><span class="line"><span class="comment"># ···</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 探测图片中的人脸</span></span><br><span class="line"><span class="attr">faces</span> = face_cascade.detectMultiScale(</span><br><span class="line">    gray,</span><br><span class="line">    <span class="attr">scaleFactor</span> = <span class="number">1.15</span>,</span><br><span class="line">    <span class="attr">minNeighbors</span> = <span class="number">5</span>,</span><br><span class="line">    <span class="attr">minSize</span> = (<span class="number">5</span>,<span class="number">5</span>),</span><br><span class="line">    <span class="attr">flags</span> = cv2.cv.CV_HAAR_SCALE_IMAGE</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>我们可以随意的指定里面参数的值，来达到不同精度下的识别。返回值就是opencv对图片的探测结果的体现。</p>
<h4 id="处理人脸探测的结果"><a href="#处理人脸探测的结果" class="headerlink" title="处理人脸探测的结果"></a>处理人脸探测的结果</h4><p>结束了刚才的人脸探测，我们就可以拿到返回值来做进一步的处理了。但这也不是说会多么的复杂，无非添加点特征值罢了。</p>
<figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line"></span><br><span class="line"># ···</span><br><span class="line"><span class="keyword">print</span> <span class="string">"发现&#123;0&#125;个人脸!"</span>.format(len(faces))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">x</span>,y,<span class="keyword">w</span>,<span class="keyword">h</span>) in faces:</span><br><span class="line">    cv2.rectangle(image,(<span class="keyword">x</span>,y),(<span class="keyword">x</span>+<span class="keyword">w</span>,y+<span class="keyword">w</span>),(<span class="number">0</span>,<span class="number">255</span>,<span class="number">0</span>),<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><p>有了刚才的基础，我们就可以完成一个简单的人脸识别的小例子了。</p>
<h3 id="图片素材"><a href="#图片素材" class="headerlink" title="图片素材"></a>图片素材</h3><p>下面的这张图片将作为我们的检测依据。<br><img src="http://img.blog.csdn.net/20160905201155361" alt="图片素材"></p>
<h3 id="人脸检测代码"><a href="#人脸检测代码" class="headerlink" title="人脸检测代码"></a>人脸检测代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">'utf8'</span>)</span><br><span class="line"><span class="comment">#    __author__ = '郭 璞'</span></span><br><span class="line"><span class="comment">#    __date__ = '2016/9/5'</span></span><br><span class="line"><span class="comment">#    __Desc__ = 人脸检测小例子，以圆圈圈出人脸</span></span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="comment"># 待检测的图片路径</span></span><br><span class="line">imagepath = <span class="string">r'./heat.jpg'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取训练好的人脸的参数数据，这里直接从GitHub上使用默认值</span></span><br><span class="line">face_cascade = cv2.CascadeClassifier(<span class="string">r'./haarcascade_frontalface_default.xml'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取图片</span></span><br><span class="line">image = cv2.imread(imagepath)</span><br><span class="line">gray = cv2.cvtColor(image,cv2.COLOR_BGR2GRAY)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 探测图片中的人脸</span></span><br><span class="line">faces = face_cascade.detectMultiScale(</span><br><span class="line">    gray,</span><br><span class="line">    scaleFactor = <span class="number">1.15</span>,</span><br><span class="line">    minNeighbors = <span class="number">5</span>,</span><br><span class="line">    minSize = (<span class="number">5</span>,<span class="number">5</span>),</span><br><span class="line">    flags = cv2.cv.CV_HAAR_SCALE_IMAGE</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"发现&#123;0&#125;个人脸!"</span>.format(len(faces))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(x,y,w,h) <span class="keyword">in</span> faces:</span><br><span class="line">    <span class="comment"># cv2.rectangle(image,(x,y),(x+w,y+w),(0,255,0),2)</span></span><br><span class="line">    cv2.circle(image,((x+x+w)/<span class="number">2</span>,(y+y+h)/<span class="number">2</span>),w/<span class="number">2</span>,(<span class="number">0</span>,<span class="number">255</span>,<span class="number">0</span>),<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">cv2.imshow(<span class="string">"Find Faces!"</span>,image)</span><br><span class="line">cv2.waitKey(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<h3 id="人脸检测结果"><a href="#人脸检测结果" class="headerlink" title="人脸检测结果"></a>人脸检测结果</h3><ul>
<li><p>输出图片：<br><img src="http://img.blog.csdn.net/20160905201249800" alt="人脸检测结果"></p>
</li>
<li><p>输出结果：</p>
</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">D:</span>\Software\Python2\python.exe <span class="string">E:</span><span class="regexp">/Code/</span>Python<span class="regexp">/DataStructor/</span>opencv/Demo.py</span><br><span class="line">发现<span class="number">3</span>个人脸!</span><br></pre></td></tr></table></figure>
<p>详情见 <a href="http://my.oschina.net/chinesezhx/blog/520917" target="_blank" rel="external">案例参考</a></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>回顾一下，这次的实验就是简单的对opencv的常用的api的使用，重点在于训练数据的使用和人脸探测的处理。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://guoruibiao.github.io/2016/09/06/OpenCV-Python-实现人脸识别/" data-id="ciwn7l61r000rksu13o7qwgba" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OpenCV/">OpenCV</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/人脸识别/">人脸识别</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-编码，解码，各种乱码" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/08/19/编码，解码，各种乱码/" class="article-date">
  <time datetime="2016-08-19T13:43:26.000Z" itemprop="datePublished">2016-08-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/19/编码，解码，各种乱码/">编码，解码，各种乱码</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<p>在开发的过程中，我们不可避免的会遇到各种各样的编码，解码，或者乱码问题，很多时候，我们可以正常的解决问题，但是说实在的，我们有可能并不清楚问题到底是怎么被解决的，秉承<font color="green" size="5">知其然，更要知其所以然</font>的理念，经过一番研究，就有了下面的这篇文章，鉴于本人功力尚浅，有错误请给予纠正 :-)</p>
<hr>
<h2 id="编码解码核心"><a href="#编码解码核心" class="headerlink" title="编码解码核心"></a>编码解码核心</h2><p>简单的来说，编码是从一个字符，比如‘郭’，到一段二进制码流的过程。解码是从一段二进制码流到一个字符的过程。<br>但是，就计算机工作原理而言，这其中涉及到了三个对象。</p>
<ul>
<li>字符 （我们在各种终端上面看得到的显示结果）</li>
<li>内码 （对应显示的字符的计算机存储数据）</li>
<li><p>字符集 （内码在内存中的具体实现）</p>
<p>这三者之间的配合如下图。<br><img src="http://img.blog.csdn.net/20160819202831797" alt="编码解码的三大对象"></p>
</li>
</ul>
<h3 id="字符"><a href="#字符" class="headerlink" title="字符"></a>字符</h3><p>对于字符而言，是我们程序员而言想必是最熟悉的了吧。什么Abs_=+/.80，都是我们所熟悉使用的字符。虽然我们表面上看到的是一个个的字符，但是在计算机而言，其真正识别和处理的不过是对应于显示的字符的一个个的内码。</p>
<h3 id="内码"><a href="#内码" class="headerlink" title="内码"></a>内码</h3><blockquote>
<p>内码是汉字在计算机内部存储，处理和传输用的信息编码。它必须与ASCII码兼容但又不能冲突。 </p>
</blockquote>
<p>也许你会想，ASCII码又是什么？ 对此，百度百科是这样解释的：</p>
<blockquote>
<p>ASCII（American Standard Code for Information Interchange，美国信息交换标准代码）是基于拉丁字母的一套电脑编码系统，主要用于显示现代英语和其他西欧语言。它是现今最通用的单字节编码系统，并等同于国际标准ISO/IEC 646。</p>
</blockquote>
<p>从这里我们不禁会想，既然是单字节编码，那么汉字这种多字节表示的信息又是怎么被计算机识别和处理的呢?</p>
<p>国标码规定：一个汉字用两个字节来表示，每个字节只用前七位，最高位均未作定义。但我们要注意，国标码不同于ASCII码，并非汉字在计算机内的真正表示代码，它仅仅是一种编码方案，计算机内部汉字的代码叫做汉字机内码，简称汉字内码。</p>
<p>所以，这也是国人在平时开发过程中经常会遇到的<font color="red" size="5">乱码问题的根源</font>。</p>
<h3 id="字符集"><a href="#字符集" class="headerlink" title="字符集"></a>字符集</h3><p>字符集作为内码在内存中的具体实现，肩负着很大的责任。</p>
<ul>
<li>ascii不仅仅指英文对应的内码，还包括它的具体实现，也就是它的字符集。它是用一个字节存储每个内码的。</li>
<li><p>unicode是所有文字(包括英文，中文，日文等)所对应的内码的集合。<br>unicode的实现方式比较多样，常用的有UTF-8，GBK，GB18030。</p>
</li>
<li><p>其中，UTF-8是一种不定长的内码实现方式。<br>GB18030兼容GBK，GBK兼容GB2312。</p>
</li>
</ul>
<p>严格点来讲，我们所谓的编码解码问题:<font color="greenblue" size="5">编码指内码编码成字符集；解码指字符集解码为内码</font></p>
<hr>
<h2 id="系统编码"><a href="#系统编码" class="headerlink" title="系统编码"></a>系统编码</h2><p>众所周知，在不同的操作系统上，支持的编码也是不太一致的。所以我们在跨平台操作的时候，需要重点考虑的问题就包括系统编码问题。</p>
<h3 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h3><p>在Windows上查询当前系统的活动代码页，就可以知道当前系统使用的编码。</p>
<blockquote>
<p>调出命令行之后输入: chcp 即可。</p>
</blockquote>
<p>基本上国人的电脑上会显示936</p>
<blockquote>
<p>936 代表GBK 扩展的EUC-CN 编码( GB 2312-80编码,包含 6763 个汉字)到Unicode (GB13000.1-93)中定义的20902个汉字,即中国大陆使用的是简体中文zh_CN.。</p>
</blockquote>
<h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><p>在Linux操作系统上查看系统编码更是方便。</p>
<blockquote>
<p>locale是最核心的一个变量。它包括12个基本属性。这12个基本属性构成某个地区的语言习惯，日期，货币，单位等文化因素。LC_ALL是强制修改locale信息的命令。LANG是locale的默认设置命令。因此，当LC_ALL强制locale信息以后，LANG的设置也就失效了。</p>
</blockquote>
<p>当然了，我们可以根据自己的喜好，来为自己的linux计算机分配系统编码。</p>
<hr>
<h2 id="Python中的编码问题"><a href="#Python中的编码问题" class="headerlink" title="Python中的编码问题"></a>Python中的编码问题</h2><p>一般而言，谈到程序编码问题，首屈一指的就是Python语言中的编码了。尤其是Unicode字符集的使用，更是让人摸不着头脑。不过，现在不用担心了，待会我会出绝招滴。</p>
<h3 id="系统编码-1"><a href="#系统编码-1" class="headerlink" title="系统编码"></a>系统编码</h3><p>经过了刚才的知识的铺垫，大家肯定对此也有了一定的感悟了。Python中的系统编码充当了一个桥梁的作用。其通常也是写源码的编辑器的编码方式。它代表源码文件内的所有内容都是根据词方式编码成二进制码流，存入到磁盘中的。</p>
<blockquote>
<p>系统编码可以通过locale命令查看（LINUX）。</p>
</blockquote>
<p>说白咯，就是操作系统是怎么存储我们的Python源程序的。</p>
<h3 id="Python编码"><a href="#Python编码" class="headerlink" title="Python编码"></a>Python编码</h3><p>这是一个比较新的概念，也是Python编码问题的根源。那就是指python内设置的解码方式。如果不设定的话，python默认是ascii解码。所以我们不难理解为什么有汉字的时候很容易出现乱码的情况了吧。</p>
<p>为了解决Python默认编码不支持汉字的窘境。我们需要手动的设置，让其识别咱们可爱的博大精深的汉字。一般有如下三种方式。</p>
<h4 id="方式一"><a href="#方式一" class="headerlink" title="方式一"></a>方式一</h4><p>只能Python识别</p>
<blockquote>
<p>在源码文件开头（一定要是第一行）：#coding=UTF-8，源码文件的设置解码方式为UTF-8</p>
</blockquote>
<h4 id="方式二"><a href="#方式二" class="headerlink" title="方式二"></a>方式二</h4><p>可以被其他的语言识别</p>
<blockquote>
<p>在源码文件开头（一定是第一行）：#-<em>-coding:UTF-8-</em>-，源码文件的设置解码方式是UTF-8</p>
</blockquote>
<h4 id="方式三"><a href="#方式三" class="headerlink" title="方式三"></a>方式三</h4><p>我经常使用的方式是方式一加方式三<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">'UTF-8'</span>)</span><br></pre></td></tr></table></figure></p>
<h3 id="文件编码"><a href="#文件编码" class="headerlink" title="文件编码"></a>文件编码</h3><p>对于文件编码，大体意思就是系统为我们即将存储的文件而进行的编码操作。</p>
<h4 id="实例一"><a href="#实例一" class="headerlink" title="实例一"></a>实例一</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">系统编码：locale：gbk</span><br><span class="line"><span class="keyword">python</span>源文件test.<span class="keyword">py</span></span><br><span class="line">#coding=<span class="string">'UTF-8'</span></span><br><span class="line">s=<span class="string">'郭'</span></span><br><span class="line"><span class="keyword">print</span> s</span><br></pre></td></tr></table></figure>
<p>在test.py被保存的那一刻，系统会以gbk的方式将数据存储到本地硬盘上，而在下次我们运行这段代码的时候，Python编码会按照源文件开头指定的utf-8编码来解码并运行，所以遇到’郭’的时候，由于码制的不同，出现乱码或者出现错误就不难理解了。</p>
<h4 id="实例二"><a href="#实例二" class="headerlink" title="实例二"></a>实例二</h4><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">系统编码：<span class="built_in">locale</span>：gbk</span><br><span class="line">test.py</span><br><span class="line">#coding=<span class="string">'gbk'</span></span><br><span class="line">s=<span class="string">'郭'</span></span><br><span class="line">ss=s.encode(<span class="string">'UTF-8'</span>)</span><br></pre></td></tr></table></figure>
<p>这个时候，系统编码仍然会以gbk的变啊买房时对源文件进行编码处理，但是在遇到<code>ss=s.encode(&#39;UTF-8&#39;)</code>的时候，会先以Python编码指定的方式将对应的字符串（二进制码流）编码，再按照系统编码对其进一步的编码处理。</p>
<p>而在下次加载的时候，程序会被以<font color="red" size="5">对二进制码流，按照解码的编码处理</font>原则处理。也就是说Python解释到<code>ss=s.encode(&#39;UTF-8&#39;)</code>行的时候，会对相应的二进制码流以utf-8的方式解码，这样就能很好的解决掉字符集不匹配的问题了。</p>
<blockquote>
<p>二进制码流（python中，所有字符串都表示的是相应的二进制码流，所有的unicode都表示的是相应的内码）</p>
</blockquote>
<h3 id="Python中字符串和Unicode的区别"><a href="#Python中字符串和Unicode的区别" class="headerlink" title="Python中字符串和Unicode的区别"></a>Python中字符串和Unicode的区别</h3><p>字符串表示的是编码后的二进制码流，unicode表示的是内码。所以，为了避免解码错误的出现，最好使用unicode表示<br>unicode的定义，使用</p>
<ul>
<li>s=u’郭’：定义unicode字符串s。s表示的是哈的unicode内码</li>
<li>ss=unicode(s,’gbk’):对字符串s按照gbk方式解码，ss表示解码后的内码</li>
<li>import codecs<br>f=codecs.open(filename,’r’,’gbk‘）<br>s=f.read()<br>按照gbk方式读取filename，读取后的内容转变成unicode内码存在变量s中。</li>
</ul>
<p>了解了以上编码解码的底层原理之后，基本上就可以应对相关的乱码问题了。</p>
<hr>
<h2 id="PHP中的编码"><a href="#PHP中的编码" class="headerlink" title="PHP中的编码"></a>PHP中的编码</h2><p>在PHP中我们也经常会遇到页面出现乱码的情况，有了上面的知识基础，我们再过来看PHP中的乱码问题，就会迎刃而解了。当然了，今天主要是来讲一讲如何解决PHP中文乱码问题。</p>
<h3 id="header"><a href="#header" class="headerlink" title="header"></a>header</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute"><span class="nomarkup">header</span></span>(<span class="string">"Content-Type:text/html;charset=utf-8"</span>);</span><br></pre></td></tr></table></figure>
<p>加上头信息的作用就是告诉浏览器，以XX方式来解码。基本上而言不会有太大的问题，但是前提是双方的系统编码能保持一致，否则也会出现由于系统编码不同而引起的乱码问题，对照Python的案例，我们也很容易可以理解。</p>
<h3 id="set-names-XX"><a href="#set-names-XX" class="headerlink" title="set names XX"></a>set names XX</h3><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_query(<span class="string">"set names UTF-8"</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>这个是对数据库数据乱码的很好的解决办法。说白了这就是所谓的“系统编码不同而引起的乱码问题的一类”。就拿MySQL数据库而言，我们是以客户端的形式来访问的数据，如果MySQL客户端的编码为gbk，而我们的浏览器解码使用的是UTF-8，请问怎么可能不会乱码呢？</p>
<p>只要保持双方的编码，解码方式一致，乱码问题，不攻自破。</p>
<hr>
<h2 id="数据库中的编码"><a href="#数据库中的编码" class="headerlink" title="数据库中的编码"></a>数据库中的编码</h2><p>通过刚才的学习，类比系统编码和文件编码。我们经常遇到的数据库信息存取出现乱码问题就可以很容易的解决了。<br>修改字符集设置即可。但是这不是一个好习惯，比较好的做法是修改读取出来的数据的编码。<br>以MySQL为例。</p>
<blockquote>
<p>可以先输入查询语句SHOW VARIABLES LIKE ‘character<em>set</em>%’;，查看所有的编码是否是UTF-8.<br>如果不是可以使用Server Instance Config 把默认的字符集设置为utf-8或者修改/MySQL/MySQL Server 5.0/my.ini中的default-character-set=gbk<br>character-set-server=gbk;<br>然后重新启动mysql的服务就行了</p>
</blockquote>
<h2 id="JSP乱码"><a href="#JSP乱码" class="headerlink" title="JSP乱码"></a>JSP乱码</h2><p>在开发JavaWeb的时候，遇到JSP乱码的情况有很多，下面着重的来探讨一下解决方案呢。</p>
<h3 id="JSP页面本身"><a href="#JSP页面本身" class="headerlink" title="JSP页面本身"></a>JSP页面本身</h3><p>每个页面上加上  这样在jsp页面里,点右键,查看编码方式则为UTF-8.</p>
<figure class="highlight erb"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">%</span></span></span><span class="ruby">@page pageEncoding=<span class="string">"UTF-8"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span> </span><span class="xml"><span class="tag">%&gt;</span></span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>也可以把设置myEclipse中默认的contentTyepe。步骤是：windows-&gt;preferences-&gt;Generl-&gt;ContentType.然后设置成UTF-8.一定要update~~<br>在JSP页面头部加入下面这句话，告诉浏览器应该调用UTF-8的字符集。</p>
</blockquote>
<p>或者使用HTML标签来声明<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=utf-8"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="数据库连接语句"><a href="#数据库连接语句" class="headerlink" title="数据库连接语句"></a>数据库连接语句</h3><ul>
<li><p>设置characterencoding为UTF-8 如<code>jdbc.mysql.url=jdbc:mysql://localhost:3306/db?useUnicode=true&amp;amp;characterEncoding=UTF8</code></p>
</li>
<li><p>如果使用Hibernate，那就把所有的配置文件头部的编码格式改成UTF-8。</p>
</li>
</ul>
<h3 id="Tomcat方面"><a href="#Tomcat方面" class="headerlink" title="Tomcat方面"></a>Tomcat方面</h3><p>为了保证get/post数据都采用相同的UTF8编码，我们在server.xml中进行了如下设置:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8080"</span> <span class="attr">protocol</span>=<span class="string">"HTTP/1.1"</span>                <span class="attr">connectionTimeout</span>=<span class="string">"20000"</span><span class="attr">redirectPort</span>=<span class="string">"8443"</span> <span class="attr">URIEncoding</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="过滤器Filter"><a href="#过滤器Filter" class="headerlink" title="过滤器Filter"></a>过滤器Filter</h3><p>有些时候，使用过滤器可以一劳永逸的解决乱码问题，原理就是强化了通信双方的编码一致性。</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在doFilter方法中添加这样的代码</span></span><br><span class="line">HttpServletRequest request = (HttpServletRequest )req;</span><br><span class="line">HttpServletResponse response = (HttpServletResponse )resp;</span><br><span class="line">request.setCharacterEncoding(<span class="string">"UTF-8"</span>);</span><br><span class="line">response.setHeader(<span class="string">"Content-Type:text/htmlcharset=UTF-8"</span>);</span><br><span class="line">response.setCharacterEncoding(<span class="string">"UTF-8"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//放行</span></span><br><span class="line">chain.doFilter(request,response);</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>回顾一下，解决乱码问题的核心就是保证编码与解码工作的一致性。无论是系统编码还是文件编码，保证编码工作和解码工作的反向一致性，基本上就不会出现乱码问题。</p>
<p>如果你发现文章中有不恰当的地方，欢迎批评指正。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://guoruibiao.github.io/2016/08/19/编码，解码，各种乱码/" data-id="ciwn7l66a004yksu1s0lyx7az" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JSP乱码/">JSP乱码</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP乱码/">PHP乱码</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python乱码/">Python乱码</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据库乱码/">数据库乱码</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/编码解码乱码/">编码解码乱码</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ajax/">Ajax</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bootstrap/">Bootstrap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Compass/">Compass</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DbHelper/">DbHelper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DbUtils/">DbUtils</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ECharts/">ECharts</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GD2/">GD2</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GitHub-Pages-Hexo/">GitHub Pages,Hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hacker/">Hacker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JDBC封装实现/">JDBC封装实现</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JQuery/">JQuery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JQuery中的Ajax/">JQuery中的Ajax</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JSON/">JSON</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JSP乱码/">JSP乱码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java拓展/">Java拓展</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux-Shell/">Linux Shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lucene/">Lucene</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lucene6-1-0/">Lucene6.1.0</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Markdown/">Markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenCV/">OpenCV</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OptParser/">OptParser</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/">PHP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP乱码/">PHP乱码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP图片上传/">PHP图片上传</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python乱码/">Python乱码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python处理JSON/">Python处理JSON</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python文本转语音/">Python文本转语音</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ruby/">Ruby</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ruby操作MySQL数据库/">Ruby操作MySQL数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Selenium/">Selenium</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell脚本大法/">Shell脚本大法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WindowsDOS翻译/">WindowsDOS翻译</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux常用工具及命令/">linux常用工具及命令</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/一键获取IP/">一键获取IP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/上传/">上传</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/人脸识别/">人脸识别</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/伪分页技术/">伪分页技术</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/全文搜索/">全文搜索</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/全文检索/">全文检索</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端使用开发技巧/">前端使用开发技巧</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/博客系统/">博客系统</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/原生Ajax/">原生Ajax</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/反射技术/">反射技术</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/回调机制/">回调机制</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/国家访问识别/">国家访问识别</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/图像处理/">图像处理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/在线聊天室/">在线聊天室</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/封装的艺术/">封装的艺术</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/异步更新页面/">异步更新页面</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/微软Speech-API/">微软Speech API</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据库乱码/">数据库乱码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/更换头像/">更换头像</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/模拟DbUtils实现StrUtils/">模拟DbUtils实现StrUtils</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/模拟实现apache-commons-dbutils/">模拟实现apache-commons-dbutils</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/水印处理/">水印处理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/添加分享/">添加分享</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/添加评论/">添加评论</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/画板小工具/">画板小工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/站内搜索/">站内搜索</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/站内检索/">站内检索</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/编码解码乱码/">编码解码乱码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/编程思想/">编程思想</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/聊天机器人/">聊天机器人</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/脚本工具/">脚本工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/自制小工具/">自制小工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/自制小框架/">自制小框架</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/自制数据库自动化小框架/">自制数据库自动化小框架</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/表单验证/">表单验证</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/适配移动端/">适配移动端</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Ajax/" style="font-size: 12px;">Ajax</a> <a href="/tags/Bootstrap/" style="font-size: 10px;">Bootstrap</a> <a href="/tags/Compass/" style="font-size: 10px;">Compass</a> <a href="/tags/DbHelper/" style="font-size: 10px;">DbHelper</a> <a href="/tags/DbUtils/" style="font-size: 12px;">DbUtils</a> <a href="/tags/ECharts/" style="font-size: 10px;">ECharts</a> <a href="/tags/GD2/" style="font-size: 10px;">GD2</a> <a href="/tags/GitHub-Pages-Hexo/" style="font-size: 10px;">GitHub Pages,Hexo</a> <a href="/tags/Hacker/" style="font-size: 10px;">Hacker</a> <a href="/tags/JDBC封装实现/" style="font-size: 10px;">JDBC封装实现</a> <a href="/tags/JQuery/" style="font-size: 12px;">JQuery</a> <a href="/tags/JQuery中的Ajax/" style="font-size: 10px;">JQuery中的Ajax</a> <a href="/tags/JSON/" style="font-size: 10px;">JSON</a> <a href="/tags/JSP乱码/" style="font-size: 10px;">JSP乱码</a> <a href="/tags/Java/" style="font-size: 10px;">Java</a> <a href="/tags/JavaScript/" style="font-size: 12px;">JavaScript</a> <a href="/tags/Java拓展/" style="font-size: 10px;">Java拓展</a> <a href="/tags/Linux-Shell/" style="font-size: 10px;">Linux Shell</a> <a href="/tags/Lucene/" style="font-size: 14px;">Lucene</a> <a href="/tags/Lucene6-1-0/" style="font-size: 10px;">Lucene6.1.0</a> <a href="/tags/Markdown/" style="font-size: 12px;">Markdown</a> <a href="/tags/MySQL/" style="font-size: 16px;">MySQL</a> <a href="/tags/OpenCV/" style="font-size: 12px;">OpenCV</a> <a href="/tags/OptParser/" style="font-size: 10px;">OptParser</a> <a href="/tags/PHP/" style="font-size: 18px;">PHP</a> <a href="/tags/PHP乱码/" style="font-size: 10px;">PHP乱码</a> <a href="/tags/PHP图片上传/" style="font-size: 10px;">PHP图片上传</a> <a href="/tags/Python/" style="font-size: 20px;">Python</a> <a href="/tags/Python乱码/" style="font-size: 10px;">Python乱码</a> <a href="/tags/Python处理JSON/" style="font-size: 10px;">Python处理JSON</a> <a href="/tags/Python文本转语音/" style="font-size: 10px;">Python文本转语音</a> <a href="/tags/Ruby/" style="font-size: 10px;">Ruby</a> <a href="/tags/Ruby操作MySQL数据库/" style="font-size: 10px;">Ruby操作MySQL数据库</a> <a href="/tags/Selenium/" style="font-size: 10px;">Selenium</a> <a href="/tags/Shell脚本大法/" style="font-size: 10px;">Shell脚本大法</a> <a href="/tags/WindowsDOS翻译/" style="font-size: 10px;">WindowsDOS翻译</a> <a href="/tags/linux常用工具及命令/" style="font-size: 10px;">linux常用工具及命令</a> <a href="/tags/一键获取IP/" style="font-size: 10px;">一键获取IP</a> <a href="/tags/上传/" style="font-size: 10px;">上传</a> <a href="/tags/人脸识别/" style="font-size: 10px;">人脸识别</a> <a href="/tags/伪分页技术/" style="font-size: 10px;">伪分页技术</a> <a href="/tags/全文搜索/" style="font-size: 10px;">全文搜索</a> <a href="/tags/全文检索/" style="font-size: 12px;">全文检索</a> <a href="/tags/前端使用开发技巧/" style="font-size: 10px;">前端使用开发技巧</a> <a href="/tags/博客系统/" style="font-size: 10px;">博客系统</a> <a href="/tags/原生Ajax/" style="font-size: 10px;">原生Ajax</a> <a href="/tags/反射技术/" style="font-size: 10px;">反射技术</a> <a href="/tags/回调机制/" style="font-size: 10px;">回调机制</a> <a href="/tags/国家访问识别/" style="font-size: 10px;">国家访问识别</a> <a href="/tags/图像处理/" style="font-size: 10px;">图像处理</a> <a href="/tags/在线聊天室/" style="font-size: 10px;">在线聊天室</a> <a href="/tags/封装的艺术/" style="font-size: 10px;">封装的艺术</a> <a href="/tags/异步更新页面/" style="font-size: 10px;">异步更新页面</a> <a href="/tags/微软Speech-API/" style="font-size: 10px;">微软Speech API</a> <a href="/tags/数据库乱码/" style="font-size: 10px;">数据库乱码</a> <a href="/tags/更换头像/" style="font-size: 10px;">更换头像</a> <a href="/tags/模拟DbUtils实现StrUtils/" style="font-size: 10px;">模拟DbUtils实现StrUtils</a> <a href="/tags/模拟实现apache-commons-dbutils/" style="font-size: 10px;">模拟实现apache-commons-dbutils</a> <a href="/tags/水印处理/" style="font-size: 10px;">水印处理</a> <a href="/tags/添加分享/" style="font-size: 10px;">添加分享</a> <a href="/tags/添加评论/" style="font-size: 10px;">添加评论</a> <a href="/tags/画板小工具/" style="font-size: 10px;">画板小工具</a> <a href="/tags/站内搜索/" style="font-size: 12px;">站内搜索</a> <a href="/tags/站内检索/" style="font-size: 12px;">站内检索</a> <a href="/tags/编码解码乱码/" style="font-size: 10px;">编码解码乱码</a> <a href="/tags/编程思想/" style="font-size: 10px;">编程思想</a> <a href="/tags/聊天机器人/" style="font-size: 10px;">聊天机器人</a> <a href="/tags/脚本工具/" style="font-size: 10px;">脚本工具</a> <a href="/tags/自制小工具/" style="font-size: 10px;">自制小工具</a> <a href="/tags/自制小框架/" style="font-size: 10px;">自制小框架</a> <a href="/tags/自制数据库自动化小框架/" style="font-size: 10px;">自制数据库自动化小框架</a> <a href="/tags/表单验证/" style="font-size: 10px;">表单验证</a> <a href="/tags/适配移动端/" style="font-size: 10px;">适配移动端</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/12/13/QQ空间模拟登陆点赞发帖/">QQ空间模拟登陆点赞发帖</a>
          </li>
        
          <li>
            <a href="/2016/11/29/文件上传工具/">文件上传工具</a>
          </li>
        
          <li>
            <a href="/2016/11/14/众里寻他千百度-轻量级持久化框架/">众里寻他千百度--轻量级持久化框架</a>
          </li>
        
          <li>
            <a href="/2016/10/31/Chatter-in-console/">Chatter in console</a>
          </li>
        
          <li>
            <a href="/2016/10/20/ECharts-In-Project/">ECharts In Project</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 郭璞<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>